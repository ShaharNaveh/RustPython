// This file is auto-generated by "crates/compiler-core/generate.py".
// DO NOT EDIT MANUALLY!

use core::fmt;

use super::oparg;
use crate::bytecode::{BorrowedConstant, Constant, InstrDisplayContext, StackEffect};

#[derive(Clone, Copy, Debug, Eq, PartialEq)]
pub enum Opcode {
    Cache,
    BinarySlice,
    BuildTemplate,
    BinaryOpInplaceAddUnicode,
    CallFunctionEx,
    CheckEgMatch,
    CheckExcMatch,
    CleanupThrow,
    DeleteSubscr,
    EndFor,
    EndSend,
    ExitInitCheck, // Placeholder
    FormatSimple,
    FormatWithSpec,
    GetAIter,
    GetANext,
    GetIter,
    Reserved,
    GetLen,
    GetYieldFromIter,
    InterpreterExit, // Placeholder
    LoadBuildClass,
    LoadLocals,
    MakeFunction,
    MatchKeys,
    MatchMapping,
    MatchSequence,
    Nop,
    NotTaken,
    PopExcept,
    PopIter,
    PopTop,
    PushExcInfo,
    PushNull,
    ReturnGenerator,
    ReturnValue,
    SetupAnnotations,
    StoreSlice,
    StoreSubscr,
    ToBool,
    UnaryInvert,
    UnaryNegative,
    UnaryNot,
    WithExceptStart,
    BinaryOp,
    BuildInterpolation,
    BuildList,
    BuildMap,
    BuildSet,
    BuildSlice,
    BuildString,
    BuildTuple,
    Call,
    CallIntrinsic1,
    CallIntrinsic2,
    CallKw,
    CompareOp,
    ContainsOp,
    ConvertValue,
    Copy,
    CopyFreeVars,
    DeleteAttr,
    DeleteDeref,
    DeleteFast,
    DeleteGlobal,
    DeleteName,
    DictMerge,
    DictUpdate,
    EndAsyncFor,
    ExtendedArg,
    ForIter,
    GetAwaitable,
    ImportFrom,
    ImportName,
    IsOp,
    JumpBackward,
    JumpBackwardNoInterrupt, // Placeholder
    JumpForward,
    ListAppend,
    ListExtend,
    LoadAttr,
    LoadCommonConstant,
    LoadConst,
    LoadDeref,
    LoadFast,
    LoadFastAndClear,
    LoadFastBorrow,
    LoadFastBorrowLoadFastBorrow,
    LoadFastCheck,
    LoadFastLoadFast,
    LoadFromDictOrDeref,
    LoadFromDictOrGlobals,
    LoadGlobal,
    LoadName,
    LoadSmallInt,
    LoadSpecial,
    LoadSuperAttr,
    MakeCell,
    MapAdd,
    MatchClass,
    PopJumpIfFalse,
    PopJumpIfNone,
    PopJumpIfNotNone,
    PopJumpIfTrue,
    RaiseVarargs,
    Reraise,
    Send,
    SetAdd,
    SetFunctionAttribute,
    SetUpdate,
    StoreAttr,
    StoreDeref,
    StoreFast,
    StoreFastLoadFast,
    StoreFastStoreFast,
    StoreGlobal,
    StoreName,
    Swap,
    UnpackEx,
    UnpackSequence,
    YieldValue,
    Resume,
    BinaryOpAddFloat,                     // Placeholder
    BinaryOpAddInt,                       // Placeholder
    BinaryOpAddUnicode,                   // Placeholder
    BinaryOpExtend,                       // Placeholder
    BinaryOpMultiplyFloat,                // Placeholder
    BinaryOpMultiplyInt,                  // Placeholder
    BinaryOpSubscrDict,                   // Placeholder
    BinaryOpSubscrGetitem,                // Placeholder
    BinaryOpSubscrListInt,                // Placeholder
    BinaryOpSubscrListSlice,              // Placeholder
    BinaryOpSubscrStrInt,                 // Placeholder
    BinaryOpSubscrTupleInt,               // Placeholder
    BinaryOpSubtractFloat,                // Placeholder
    BinaryOpSubtractInt,                  // Placeholder
    CallAllocAndEnterInit,                // Placeholder
    CallBoundMethodExactArgs,             // Placeholder
    CallBoundMethodGeneral,               // Placeholder
    CallBuiltinClass,                     // Placeholder
    CallBuiltinFast,                      // Placeholder
    CallBuiltinFastWithKeywords,          // Placeholder
    CallBuiltinO,                         // Placeholder
    CallIsinstance,                       // Placeholder
    CallKwBoundMethod,                    // Placeholder
    CallKwNonPy,                          // Placeholder
    CallKwPy,                             // Placeholder
    CallLen,                              // Placeholder
    CallListAppend,                       // Placeholder
    CallMethodDescriptorFast,             // Placeholder
    CallMethodDescriptorFastWithKeywords, // Placeholder
    CallMethodDescriptorNoargs,           // Placeholder
    CallMethodDescriptorO,                // Placeholder
    CallNonPyGeneral,                     // Placeholder
    CallPyExactArgs,                      // Placeholder
    CallPyGeneral,                        // Placeholder
    CallStr1,                             // Placeholder
    CallTuple1,                           // Placeholder
    CallType1,                            // Placeholder
    CompareOpFloat,                       // Placeholder
    CompareOpInt,                         // Placeholder
    CompareOpStr,                         // Placeholder
    ContainsOpDict,                       // Placeholder
    ContainsOpSet,                        // Placeholder
    ForIterGen,                           // Placeholder
    ForIterList,                          // Placeholder
    ForIterRange,                         // Placeholder
    ForIterTuple,                         // Placeholder
    JumpBackwardJit,                      // Placeholder
    JumpBackwardNoJit,                    // Placeholder
    LoadAttrClass,                        // Placeholder
    LoadAttrClassWithMetaclassCheck,      // Placeholder
    LoadAttrGetattributeOverridden,       // Placeholder
    LoadAttrInstanceValue,                // Placeholder
    LoadAttrMethodLazyDict,               // Placeholder
    LoadAttrMethodNoDict,                 // Placeholder
    LoadAttrMethodWithValues,             // Placeholder
    LoadAttrModule,                       // Placeholder
    LoadAttrNondescriptorNoDict,          // Placeholder
    LoadAttrNondescriptorWithValues,      // Placeholder
    LoadAttrProperty,                     // Placeholder
    LoadAttrSlot,                         // Placeholder
    LoadAttrWithHint,                     // Placeholder
    LoadConstImmortal,                    // Placeholder
    LoadConstMortal,                      // Placeholder
    LoadGlobalBuiltin,                    // Placeholder
    LoadGlobalModule,                     // Placeholder
    LoadSuperAttrAttr,                    // Placeholder
    LoadSuperAttrMethod,                  // Placeholder
    ResumeCheck,                          // Placeholder
    SendGen,                              // Placeholder
    StoreAttrInstanceValue,               // Placeholder
    StoreAttrSlot,                        // Placeholder
    StoreAttrWithHint,                    // Placeholder
    StoreSubscrDict,                      // Placeholder
    StoreSubscrListInt,                   // Placeholder
    ToBoolAlwaysTrue,                     // Placeholder
    ToBoolBool,                           // Placeholder
    ToBoolInt,                            // Placeholder
    ToBoolList,                           // Placeholder
    ToBoolNone,                           // Placeholder
    ToBoolStr,                            // Placeholder
    UnpackSequenceList,                   // Placeholder
    UnpackSequenceTuple,                  // Placeholder
    UnpackSequenceTwoTuple,               // Placeholder
    InstrumentedEndFor,                   // Placeholder
    InstrumentedPopIter,                  // Placeholder
    InstrumentedEndSend,                  // Placeholder
    InstrumentedForIter,                  // Placeholder
    InstrumentedInstruction,              // Placeholder
    InstrumentedJumpForward,              // Placeholder
    InstrumentedNotTaken,                 // Placeholder
    InstrumentedPopJumpIfTrue,            // Placeholder
    InstrumentedPopJumpIfFalse,           // Placeholder
    InstrumentedPopJumpIfNone,            // Placeholder
    InstrumentedPopJumpIfNotNone,         // Placeholder
    InstrumentedResume,                   // Placeholder
    InstrumentedReturnValue,              // Placeholder
    InstrumentedYieldValue,               // Placeholder
    InstrumentedEndAsyncFor,              // Placeholder
    InstrumentedLoadSuperAttr,            // Placeholder
    InstrumentedCall,                     // Placeholder
    InstrumentedCallKw,                   // Placeholder
    InstrumentedCallFunctionEx,           // Placeholder
    InstrumentedJumpBackward,             // Placeholder
    InstrumentedLine,                     // Placeholder
    EnterExecutor,                        // Placeholder
}

impl Opcode {
    /// Whether opcode ID have 'HAS_ARG_FLAG' set.
    #[must_use]
    pub const fn has_arg(self) -> bool {
        matches!(
            self,
            Self::BinaryOp
                | Self::BuildInterpolation
                | Self::BuildList
                | Self::BuildMap
                | Self::BuildSet
                | Self::BuildSlice
                | Self::BuildString
                | Self::BuildTuple
                | Self::Call
                | Self::CallIntrinsic1
                | Self::CallIntrinsic2
                | Self::CallKw
                | Self::CompareOp
                | Self::ContainsOp
                | Self::ConvertValue
                | Self::Copy
                | Self::CopyFreeVars
                | Self::DeleteAttr
                | Self::DeleteDeref
                | Self::DeleteFast
                | Self::DeleteGlobal
                | Self::DeleteName
                | Self::DictMerge
                | Self::DictUpdate
                | Self::EndAsyncFor
                | Self::ExtendedArg
                | Self::ForIter
                | Self::GetAwaitable
                | Self::ImportFrom
                | Self::ImportName
                | Self::IsOp
                | Self::JumpBackward
                | Self::JumpBackwardNoInterrupt
                | Self::JumpForward
                | Self::ListAppend
                | Self::ListExtend
                | Self::LoadAttr
                | Self::LoadCommonConstant
                | Self::LoadConst
                | Self::LoadDeref
                | Self::LoadFast
                | Self::LoadFastAndClear
                | Self::LoadFastBorrow
                | Self::LoadFastBorrowLoadFastBorrow
                | Self::LoadFastCheck
                | Self::LoadFastLoadFast
                | Self::LoadFromDictOrDeref
                | Self::LoadFromDictOrGlobals
                | Self::LoadGlobal
                | Self::LoadName
                | Self::LoadSmallInt
                | Self::LoadSpecial
                | Self::LoadSuperAttr
                | Self::MakeCell
                | Self::MapAdd
                | Self::MatchClass
                | Self::PopJumpIfFalse
                | Self::PopJumpIfNone
                | Self::PopJumpIfNotNone
                | Self::PopJumpIfTrue
                | Self::RaiseVarargs
                | Self::Reraise
                | Self::Send
                | Self::SetAdd
                | Self::SetFunctionAttribute
                | Self::SetUpdate
                | Self::StoreAttr
                | Self::StoreDeref
                | Self::StoreFast
                | Self::StoreFastLoadFast
                | Self::StoreFastStoreFast
                | Self::StoreGlobal
                | Self::StoreName
                | Self::Swap
                | Self::UnpackEx
                | Self::UnpackSequence
                | Self::YieldValue
                | Self::Resume
                | Self::CallAllocAndEnterInit
                | Self::CallBoundMethodExactArgs
                | Self::CallBoundMethodGeneral
                | Self::CallBuiltinClass
                | Self::CallBuiltinFast
                | Self::CallBuiltinFastWithKeywords
                | Self::CallBuiltinO
                | Self::CallIsinstance
                | Self::CallKwBoundMethod
                | Self::CallKwNonPy
                | Self::CallKwPy
                | Self::CallListAppend
                | Self::CallMethodDescriptorFast
                | Self::CallMethodDescriptorFastWithKeywords
                | Self::CallMethodDescriptorNoargs
                | Self::CallMethodDescriptorO
                | Self::CallNonPyGeneral
                | Self::CallPyExactArgs
                | Self::CallPyGeneral
                | Self::CallStr1
                | Self::CallTuple1
                | Self::CallType1
                | Self::CompareOpFloat
                | Self::CompareOpInt
                | Self::CompareOpStr
                | Self::ContainsOpDict
                | Self::ContainsOpSet
                | Self::ForIterGen
                | Self::ForIterList
                | Self::ForIterRange
                | Self::ForIterTuple
                | Self::JumpBackwardJit
                | Self::JumpBackwardNoJit
                | Self::LoadAttrClass
                | Self::LoadAttrClassWithMetaclassCheck
                | Self::LoadAttrGetattributeOverridden
                | Self::LoadAttrInstanceValue
                | Self::LoadAttrMethodLazyDict
                | Self::LoadAttrMethodNoDict
                | Self::LoadAttrMethodWithValues
                | Self::LoadAttrModule
                | Self::LoadAttrNondescriptorNoDict
                | Self::LoadAttrNondescriptorWithValues
                | Self::LoadAttrProperty
                | Self::LoadAttrSlot
                | Self::LoadAttrWithHint
                | Self::LoadConstImmortal
                | Self::LoadConstMortal
                | Self::LoadGlobalBuiltin
                | Self::LoadGlobalModule
                | Self::LoadSuperAttrAttr
                | Self::LoadSuperAttrMethod
                | Self::SendGen
                | Self::StoreAttrWithHint
                | Self::UnpackSequenceList
                | Self::UnpackSequenceTuple
                | Self::UnpackSequenceTwoTuple
                | Self::InstrumentedForIter
                | Self::InstrumentedJumpForward
                | Self::InstrumentedPopJumpIfTrue
                | Self::InstrumentedPopJumpIfFalse
                | Self::InstrumentedPopJumpIfNone
                | Self::InstrumentedPopJumpIfNotNone
                | Self::InstrumentedResume
                | Self::InstrumentedYieldValue
                | Self::InstrumentedEndAsyncFor
                | Self::InstrumentedLoadSuperAttr
                | Self::InstrumentedCall
                | Self::InstrumentedCallKw
                | Self::InstrumentedJumpBackward
                | Self::EnterExecutor
        )
    }

    /// Whether opcode ID have 'HAS_CONST_FLAG' set.
    #[must_use]
    pub const fn has_const(self) -> bool {
        matches!(
            self,
            Self::LoadConst | Self::LoadConstImmortal | Self::LoadConstMortal
        )
    }

    /// Whether opcode ID have 'HAS_PURE_FLAG' set.
    #[must_use]
    pub const fn has_exc(self) -> bool {
        matches!(
            self,
            Self::EndSend
                | Self::Nop
                | Self::NotTaken
                | Self::PopIter
                | Self::PopTop
                | Self::PushNull
                | Self::UnaryNot
                | Self::Copy
                | Self::LoadFast
                | Self::LoadFastBorrow
                | Self::Swap
        )
    }

    /// Whether opcode ID have 'HAS_JUMP_FLAG' set.
    #[must_use]
    pub const fn has_jump(self) -> bool {
        matches!(
            self,
            Self::EndAsyncFor
                | Self::ForIter
                | Self::JumpBackward
                | Self::JumpBackwardNoInterrupt
                | Self::JumpForward
                | Self::PopJumpIfFalse
                | Self::PopJumpIfNone
                | Self::PopJumpIfNotNone
                | Self::PopJumpIfTrue
                | Self::Send
                | Self::ForIterList
                | Self::ForIterRange
                | Self::ForIterTuple
                | Self::JumpBackwardJit
                | Self::JumpBackwardNoJit
                | Self::InstrumentedForIter
                | Self::InstrumentedEndAsyncFor
        )
    }

    /// Whether opcode ID have 'HAS_LOCAL_FLAG' set.
    #[must_use]
    pub const fn has_local(self) -> bool {
        matches!(
            self,
            Self::BinaryOpInplaceAddUnicode
                | Self::DeleteFast
                | Self::LoadDeref
                | Self::LoadFast
                | Self::LoadFastAndClear
                | Self::LoadFastBorrow
                | Self::LoadFastBorrowLoadFastBorrow
                | Self::LoadFastCheck
                | Self::LoadFastLoadFast
                | Self::StoreFast
                | Self::StoreFastLoadFast
                | Self::StoreFastStoreFast
        )
    }

    /// Whether opcode ID have 'HAS_NAME_FLAG' set.
    #[must_use]
    pub const fn has_name(self) -> bool {
        matches!(
            self,
            Self::DeleteAttr
                | Self::DeleteGlobal
                | Self::DeleteName
                | Self::ImportFrom
                | Self::ImportName
                | Self::LoadAttr
                | Self::LoadFromDictOrGlobals
                | Self::LoadGlobal
                | Self::LoadName
                | Self::LoadSuperAttr
                | Self::StoreAttr
                | Self::StoreGlobal
                | Self::StoreName
                | Self::LoadAttrGetattributeOverridden
                | Self::LoadAttrWithHint
                | Self::LoadSuperAttrAttr
                | Self::LoadSuperAttrMethod
                | Self::StoreAttrWithHint
                | Self::InstrumentedLoadSuperAttr
        )
    }
}

impl fmt::Display for Opcode {
    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
        let name = match self {
            Self::Cache => "CACHE",
            Self::BinarySlice => "BINARY_SLICE",
            Self::BuildTemplate => "BUILD_TEMPLATE",
            Self::BinaryOpInplaceAddUnicode => "BINARY_OP_INPLACE_ADD_UNICODE",
            Self::CallFunctionEx => "CALL_FUNCTION_EX",
            Self::CheckEgMatch => "CHECK_EG_MATCH",
            Self::CheckExcMatch => "CHECK_EXC_MATCH",
            Self::CleanupThrow => "CLEANUP_THROW",
            Self::DeleteSubscr => "DELETE_SUBSCR",
            Self::EndFor => "END_FOR",
            Self::EndSend => "END_SEND",
            Self::ExitInitCheck => "EXIT_INIT_CHECK",
            Self::FormatSimple => "FORMAT_SIMPLE",
            Self::FormatWithSpec => "FORMAT_WITH_SPEC",
            Self::GetAIter => "GET_AITER",
            Self::GetANext => "GET_ANEXT",
            Self::GetIter => "GET_ITER",
            Self::Reserved => "RESERVED",
            Self::GetLen => "GET_LEN",
            Self::GetYieldFromIter => "GET_YIELD_FROM_ITER",
            Self::InterpreterExit => "INTERPRETER_EXIT",
            Self::LoadBuildClass => "LOAD_BUILD_CLASS",
            Self::LoadLocals => "LOAD_LOCALS",
            Self::MakeFunction => "MAKE_FUNCTION",
            Self::MatchKeys => "MATCH_KEYS",
            Self::MatchMapping => "MATCH_MAPPING",
            Self::MatchSequence => "MATCH_SEQUENCE",
            Self::Nop => "NOP",
            Self::NotTaken => "NOT_TAKEN",
            Self::PopExcept => "POP_EXCEPT",
            Self::PopIter => "POP_ITER",
            Self::PopTop => "POP_TOP",
            Self::PushExcInfo => "PUSH_EXC_INFO",
            Self::PushNull => "PUSH_NULL",
            Self::ReturnGenerator => "RETURN_GENERATOR",
            Self::ReturnValue => "RETURN_VALUE",
            Self::SetupAnnotations => "SETUP_ANNOTATIONS",
            Self::StoreSlice => "STORE_SLICE",
            Self::StoreSubscr => "STORE_SUBSCR",
            Self::ToBool => "TO_BOOL",
            Self::UnaryInvert => "UNARY_INVERT",
            Self::UnaryNegative => "UNARY_NEGATIVE",
            Self::UnaryNot => "UNARY_NOT",
            Self::WithExceptStart => "WITH_EXCEPT_START",
            Self::BinaryOp => "BINARY_OP",
            Self::BuildInterpolation => "BUILD_INTERPOLATION",
            Self::BuildList => "BUILD_LIST",
            Self::BuildMap => "BUILD_MAP",
            Self::BuildSet => "BUILD_SET",
            Self::BuildSlice => "BUILD_SLICE",
            Self::BuildString => "BUILD_STRING",
            Self::BuildTuple => "BUILD_TUPLE",
            Self::Call => "CALL",
            Self::CallIntrinsic1 => "CALL_INTRINSIC_1",
            Self::CallIntrinsic2 => "CALL_INTRINSIC_2",
            Self::CallKw => "CALL_KW",
            Self::CompareOp => "COMPARE_OP",
            Self::ContainsOp => "CONTAINS_OP",
            Self::ConvertValue => "CONVERT_VALUE",
            Self::Copy => "COPY",
            Self::CopyFreeVars => "COPY_FREE_VARS",
            Self::DeleteAttr => "DELETE_ATTR",
            Self::DeleteDeref => "DELETE_DEREF",
            Self::DeleteFast => "DELETE_FAST",
            Self::DeleteGlobal => "DELETE_GLOBAL",
            Self::DeleteName => "DELETE_NAME",
            Self::DictMerge => "DICT_MERGE",
            Self::DictUpdate => "DICT_UPDATE",
            Self::EndAsyncFor => "END_ASYNC_FOR",
            Self::ExtendedArg => "EXTENDED_ARG",
            Self::ForIter => "FOR_ITER",
            Self::GetAwaitable => "GET_AWAITABLE",
            Self::ImportFrom => "IMPORT_FROM",
            Self::ImportName => "IMPORT_NAME",
            Self::IsOp => "IS_OP",
            Self::JumpBackward => "JUMP_BACKWARD",
            Self::JumpBackwardNoInterrupt => "JUMP_BACKWARD_NO_INTERRUPT",
            Self::JumpForward => "JUMP_FORWARD",
            Self::ListAppend => "LIST_APPEND",
            Self::ListExtend => "LIST_EXTEND",
            Self::LoadAttr => "LOAD_ATTR",
            Self::LoadCommonConstant => "LOAD_COMMON_CONSTANT",
            Self::LoadConst => "LOAD_CONST",
            Self::LoadDeref => "LOAD_DEREF",
            Self::LoadFast => "LOAD_FAST",
            Self::LoadFastAndClear => "LOAD_FAST_AND_CLEAR",
            Self::LoadFastBorrow => "LOAD_FAST_BORROW",
            Self::LoadFastBorrowLoadFastBorrow => "LOAD_FAST_BORROW_LOAD_FAST_BORROW",
            Self::LoadFastCheck => "LOAD_FAST_CHECK",
            Self::LoadFastLoadFast => "LOAD_FAST_LOAD_FAST",
            Self::LoadFromDictOrDeref => "LOAD_FROM_DICT_OR_DEREF",
            Self::LoadFromDictOrGlobals => "LOAD_FROM_DICT_OR_GLOBALS",
            Self::LoadGlobal => "LOAD_GLOBAL",
            Self::LoadName => "LOAD_NAME",
            Self::LoadSmallInt => "LOAD_SMALL_INT",
            Self::LoadSpecial => "LOAD_SPECIAL",
            Self::LoadSuperAttr => "LOAD_SUPER_ATTR",
            Self::MakeCell => "MAKE_CELL",
            Self::MapAdd => "MAP_ADD",
            Self::MatchClass => "MATCH_CLASS",
            Self::PopJumpIfFalse => "POP_JUMP_IF_FALSE",
            Self::PopJumpIfNone => "POP_JUMP_IF_NONE",
            Self::PopJumpIfNotNone => "POP_JUMP_IF_NOT_NONE",
            Self::PopJumpIfTrue => "POP_JUMP_IF_TRUE",
            Self::RaiseVarargs => "RAISE_VARARGS",
            Self::Reraise => "RERAISE",
            Self::Send => "SEND",
            Self::SetAdd => "SET_ADD",
            Self::SetFunctionAttribute => "SET_FUNCTION_ATTRIBUTE",
            Self::SetUpdate => "SET_UPDATE",
            Self::StoreAttr => "STORE_ATTR",
            Self::StoreDeref => "STORE_DEREF",
            Self::StoreFast => "STORE_FAST",
            Self::StoreFastLoadFast => "STORE_FAST_LOAD_FAST",
            Self::StoreFastStoreFast => "STORE_FAST_STORE_FAST",
            Self::StoreGlobal => "STORE_GLOBAL",
            Self::StoreName => "STORE_NAME",
            Self::Swap => "SWAP",
            Self::UnpackEx => "UNPACK_EX",
            Self::UnpackSequence => "UNPACK_SEQUENCE",
            Self::YieldValue => "YIELD_VALUE",
            Self::Resume => "RESUME",
            Self::BinaryOpAddFloat => "BINARY_OP_ADD_FLOAT",
            Self::BinaryOpAddInt => "BINARY_OP_ADD_INT",
            Self::BinaryOpAddUnicode => "BINARY_OP_ADD_UNICODE",
            Self::BinaryOpExtend => "BINARY_OP_EXTEND",
            Self::BinaryOpMultiplyFloat => "BINARY_OP_MULTIPLY_FLOAT",
            Self::BinaryOpMultiplyInt => "BINARY_OP_MULTIPLY_INT",
            Self::BinaryOpSubscrDict => "BINARY_OP_SUBSCR_DICT",
            Self::BinaryOpSubscrGetitem => "BINARY_OP_SUBSCR_GETITEM",
            Self::BinaryOpSubscrListInt => "BINARY_OP_SUBSCR_LIST_INT",
            Self::BinaryOpSubscrListSlice => "BINARY_OP_SUBSCR_LIST_SLICE",
            Self::BinaryOpSubscrStrInt => "BINARY_OP_SUBSCR_STR_INT",
            Self::BinaryOpSubscrTupleInt => "BINARY_OP_SUBSCR_TUPLE_INT",
            Self::BinaryOpSubtractFloat => "BINARY_OP_SUBTRACT_FLOAT",
            Self::BinaryOpSubtractInt => "BINARY_OP_SUBTRACT_INT",
            Self::CallAllocAndEnterInit => "CALL_ALLOC_AND_ENTER_INIT",
            Self::CallBoundMethodExactArgs => "CALL_BOUND_METHOD_EXACT_ARGS",
            Self::CallBoundMethodGeneral => "CALL_BOUND_METHOD_GENERAL",
            Self::CallBuiltinClass => "CALL_BUILTIN_CLASS",
            Self::CallBuiltinFast => "CALL_BUILTIN_FAST",
            Self::CallBuiltinFastWithKeywords => "CALL_BUILTIN_FAST_WITH_KEYWORDS",
            Self::CallBuiltinO => "CALL_BUILTIN_O",
            Self::CallIsinstance => "CALL_ISINSTANCE",
            Self::CallKwBoundMethod => "CALL_KW_BOUND_METHOD",
            Self::CallKwNonPy => "CALL_KW_NON_PY",
            Self::CallKwPy => "CALL_KW_PY",
            Self::CallLen => "CALL_LEN",
            Self::CallListAppend => "CALL_LIST_APPEND",
            Self::CallMethodDescriptorFast => "CALL_METHOD_DESCRIPTOR_FAST",
            Self::CallMethodDescriptorFastWithKeywords => {
                "CALL_METHOD_DESCRIPTOR_FAST_WITH_KEYWORDS"
            }
            Self::CallMethodDescriptorNoargs => "CALL_METHOD_DESCRIPTOR_NOARGS",
            Self::CallMethodDescriptorO => "CALL_METHOD_DESCRIPTOR_O",
            Self::CallNonPyGeneral => "CALL_NON_PY_GENERAL",
            Self::CallPyExactArgs => "CALL_PY_EXACT_ARGS",
            Self::CallPyGeneral => "CALL_PY_GENERAL",
            Self::CallStr1 => "CALL_STR_1",
            Self::CallTuple1 => "CALL_TUPLE_1",
            Self::CallType1 => "CALL_TYPE_1",
            Self::CompareOpFloat => "COMPARE_OP_FLOAT",
            Self::CompareOpInt => "COMPARE_OP_INT",
            Self::CompareOpStr => "COMPARE_OP_STR",
            Self::ContainsOpDict => "CONTAINS_OP_DICT",
            Self::ContainsOpSet => "CONTAINS_OP_SET",
            Self::ForIterGen => "FOR_ITER_GEN",
            Self::ForIterList => "FOR_ITER_LIST",
            Self::ForIterRange => "FOR_ITER_RANGE",
            Self::ForIterTuple => "FOR_ITER_TUPLE",
            Self::JumpBackwardJit => "JUMP_BACKWARD_JIT",
            Self::JumpBackwardNoJit => "JUMP_BACKWARD_NO_JIT",
            Self::LoadAttrClass => "LOAD_ATTR_CLASS",
            Self::LoadAttrClassWithMetaclassCheck => "LOAD_ATTR_CLASS_WITH_METACLASS_CHECK",
            Self::LoadAttrGetattributeOverridden => "LOAD_ATTR_GETATTRIBUTE_OVERRIDDEN",
            Self::LoadAttrInstanceValue => "LOAD_ATTR_INSTANCE_VALUE",
            Self::LoadAttrMethodLazyDict => "LOAD_ATTR_METHOD_LAZY_DICT",
            Self::LoadAttrMethodNoDict => "LOAD_ATTR_METHOD_NO_DICT",
            Self::LoadAttrMethodWithValues => "LOAD_ATTR_METHOD_WITH_VALUES",
            Self::LoadAttrModule => "LOAD_ATTR_MODULE",
            Self::LoadAttrNondescriptorNoDict => "LOAD_ATTR_NONDESCRIPTOR_NO_DICT",
            Self::LoadAttrNondescriptorWithValues => "LOAD_ATTR_NONDESCRIPTOR_WITH_VALUES",
            Self::LoadAttrProperty => "LOAD_ATTR_PROPERTY",
            Self::LoadAttrSlot => "LOAD_ATTR_SLOT",
            Self::LoadAttrWithHint => "LOAD_ATTR_WITH_HINT",
            Self::LoadConstImmortal => "LOAD_CONST_IMMORTAL",
            Self::LoadConstMortal => "LOAD_CONST_MORTAL",
            Self::LoadGlobalBuiltin => "LOAD_GLOBAL_BUILTIN",
            Self::LoadGlobalModule => "LOAD_GLOBAL_MODULE",
            Self::LoadSuperAttrAttr => "LOAD_SUPER_ATTR_ATTR",
            Self::LoadSuperAttrMethod => "LOAD_SUPER_ATTR_METHOD",
            Self::ResumeCheck => "RESUME_CHECK",
            Self::SendGen => "SEND_GEN",
            Self::StoreAttrInstanceValue => "STORE_ATTR_INSTANCE_VALUE",
            Self::StoreAttrSlot => "STORE_ATTR_SLOT",
            Self::StoreAttrWithHint => "STORE_ATTR_WITH_HINT",
            Self::StoreSubscrDict => "STORE_SUBSCR_DICT",
            Self::StoreSubscrListInt => "STORE_SUBSCR_LIST_INT",
            Self::ToBoolAlwaysTrue => "TO_BOOL_ALWAYS_TRUE",
            Self::ToBoolBool => "TO_BOOL_BOOL",
            Self::ToBoolInt => "TO_BOOL_INT",
            Self::ToBoolList => "TO_BOOL_LIST",
            Self::ToBoolNone => "TO_BOOL_NONE",
            Self::ToBoolStr => "TO_BOOL_STR",
            Self::UnpackSequenceList => "UNPACK_SEQUENCE_LIST",
            Self::UnpackSequenceTuple => "UNPACK_SEQUENCE_TUPLE",
            Self::UnpackSequenceTwoTuple => "UNPACK_SEQUENCE_TWO_TUPLE",
            Self::InstrumentedEndFor => "INSTRUMENTED_END_FOR",
            Self::InstrumentedPopIter => "INSTRUMENTED_POP_ITER",
            Self::InstrumentedEndSend => "INSTRUMENTED_END_SEND",
            Self::InstrumentedForIter => "INSTRUMENTED_FOR_ITER",
            Self::InstrumentedInstruction => "INSTRUMENTED_INSTRUCTION",
            Self::InstrumentedJumpForward => "INSTRUMENTED_JUMP_FORWARD",
            Self::InstrumentedNotTaken => "INSTRUMENTED_NOT_TAKEN",
            Self::InstrumentedPopJumpIfTrue => "INSTRUMENTED_POP_JUMP_IF_TRUE",
            Self::InstrumentedPopJumpIfFalse => "INSTRUMENTED_POP_JUMP_IF_FALSE",
            Self::InstrumentedPopJumpIfNone => "INSTRUMENTED_POP_JUMP_IF_NONE",
            Self::InstrumentedPopJumpIfNotNone => "INSTRUMENTED_POP_JUMP_IF_NOT_NONE",
            Self::InstrumentedResume => "INSTRUMENTED_RESUME",
            Self::InstrumentedReturnValue => "INSTRUMENTED_RETURN_VALUE",
            Self::InstrumentedYieldValue => "INSTRUMENTED_YIELD_VALUE",
            Self::InstrumentedEndAsyncFor => "INSTRUMENTED_END_ASYNC_FOR",
            Self::InstrumentedLoadSuperAttr => "INSTRUMENTED_LOAD_SUPER_ATTR",
            Self::InstrumentedCall => "INSTRUMENTED_CALL",
            Self::InstrumentedCallKw => "INSTRUMENTED_CALL_KW",
            Self::InstrumentedCallFunctionEx => "INSTRUMENTED_CALL_FUNCTION_EX",
            Self::InstrumentedJumpBackward => "INSTRUMENTED_JUMP_BACKWARD",
            Self::InstrumentedLine => "INSTRUMENTED_LINE",
            Self::EnterExecutor => "ENTER_EXECUTOR",
        };
        write!(f, "{name}")
    }
}

impl From<Opcode> for u8 {
    fn from(value: Opcode) -> Self {
        match value {
            Opcode::Cache => 0,
            Opcode::BinarySlice => 1,
            Opcode::BuildTemplate => 2,
            Opcode::BinaryOpInplaceAddUnicode => 3,
            Opcode::CallFunctionEx => 4,
            Opcode::CheckEgMatch => 5,
            Opcode::CheckExcMatch => 6,
            Opcode::CleanupThrow => 7,
            Opcode::DeleteSubscr => 8,
            Opcode::EndFor => 9,
            Opcode::EndSend => 10,
            Opcode::ExitInitCheck => 11,
            Opcode::FormatSimple => 12,
            Opcode::FormatWithSpec => 13,
            Opcode::GetAIter => 14,
            Opcode::GetANext => 15,
            Opcode::GetIter => 16,
            Opcode::Reserved => 17,
            Opcode::GetLen => 18,
            Opcode::GetYieldFromIter => 19,
            Opcode::InterpreterExit => 20,
            Opcode::LoadBuildClass => 21,
            Opcode::LoadLocals => 22,
            Opcode::MakeFunction => 23,
            Opcode::MatchKeys => 24,
            Opcode::MatchMapping => 25,
            Opcode::MatchSequence => 26,
            Opcode::Nop => 27,
            Opcode::NotTaken => 28,
            Opcode::PopExcept => 29,
            Opcode::PopIter => 30,
            Opcode::PopTop => 31,
            Opcode::PushExcInfo => 32,
            Opcode::PushNull => 33,
            Opcode::ReturnGenerator => 34,
            Opcode::ReturnValue => 35,
            Opcode::SetupAnnotations => 36,
            Opcode::StoreSlice => 37,
            Opcode::StoreSubscr => 38,
            Opcode::ToBool => 39,
            Opcode::UnaryInvert => 40,
            Opcode::UnaryNegative => 41,
            Opcode::UnaryNot => 42,
            Opcode::WithExceptStart => 43,
            Opcode::BinaryOp => 44,
            Opcode::BuildInterpolation => 45,
            Opcode::BuildList => 46,
            Opcode::BuildMap => 47,
            Opcode::BuildSet => 48,
            Opcode::BuildSlice => 49,
            Opcode::BuildString => 50,
            Opcode::BuildTuple => 51,
            Opcode::Call => 52,
            Opcode::CallIntrinsic1 => 53,
            Opcode::CallIntrinsic2 => 54,
            Opcode::CallKw => 55,
            Opcode::CompareOp => 56,
            Opcode::ContainsOp => 57,
            Opcode::ConvertValue => 58,
            Opcode::Copy => 59,
            Opcode::CopyFreeVars => 60,
            Opcode::DeleteAttr => 61,
            Opcode::DeleteDeref => 62,
            Opcode::DeleteFast => 63,
            Opcode::DeleteGlobal => 64,
            Opcode::DeleteName => 65,
            Opcode::DictMerge => 66,
            Opcode::DictUpdate => 67,
            Opcode::EndAsyncFor => 68,
            Opcode::ExtendedArg => 69,
            Opcode::ForIter => 70,
            Opcode::GetAwaitable => 71,
            Opcode::ImportFrom => 72,
            Opcode::ImportName => 73,
            Opcode::IsOp => 74,
            Opcode::JumpBackward => 75,
            Opcode::JumpBackwardNoInterrupt => 76,
            Opcode::JumpForward => 77,
            Opcode::ListAppend => 78,
            Opcode::ListExtend => 79,
            Opcode::LoadAttr => 80,
            Opcode::LoadCommonConstant => 81,
            Opcode::LoadConst => 82,
            Opcode::LoadDeref => 83,
            Opcode::LoadFast => 84,
            Opcode::LoadFastAndClear => 85,
            Opcode::LoadFastBorrow => 86,
            Opcode::LoadFastBorrowLoadFastBorrow => 87,
            Opcode::LoadFastCheck => 88,
            Opcode::LoadFastLoadFast => 89,
            Opcode::LoadFromDictOrDeref => 90,
            Opcode::LoadFromDictOrGlobals => 91,
            Opcode::LoadGlobal => 92,
            Opcode::LoadName => 93,
            Opcode::LoadSmallInt => 94,
            Opcode::LoadSpecial => 95,
            Opcode::LoadSuperAttr => 96,
            Opcode::MakeCell => 97,
            Opcode::MapAdd => 98,
            Opcode::MatchClass => 99,
            Opcode::PopJumpIfFalse => 100,
            Opcode::PopJumpIfNone => 101,
            Opcode::PopJumpIfNotNone => 102,
            Opcode::PopJumpIfTrue => 103,
            Opcode::RaiseVarargs => 104,
            Opcode::Reraise => 105,
            Opcode::Send => 106,
            Opcode::SetAdd => 107,
            Opcode::SetFunctionAttribute => 108,
            Opcode::SetUpdate => 109,
            Opcode::StoreAttr => 110,
            Opcode::StoreDeref => 111,
            Opcode::StoreFast => 112,
            Opcode::StoreFastLoadFast => 113,
            Opcode::StoreFastStoreFast => 114,
            Opcode::StoreGlobal => 115,
            Opcode::StoreName => 116,
            Opcode::Swap => 117,
            Opcode::UnpackEx => 118,
            Opcode::UnpackSequence => 119,
            Opcode::YieldValue => 120,
            Opcode::Resume => 128,
            Opcode::BinaryOpAddFloat => 129,
            Opcode::BinaryOpAddInt => 130,
            Opcode::BinaryOpAddUnicode => 131,
            Opcode::BinaryOpExtend => 132,
            Opcode::BinaryOpMultiplyFloat => 133,
            Opcode::BinaryOpMultiplyInt => 134,
            Opcode::BinaryOpSubscrDict => 135,
            Opcode::BinaryOpSubscrGetitem => 136,
            Opcode::BinaryOpSubscrListInt => 137,
            Opcode::BinaryOpSubscrListSlice => 138,
            Opcode::BinaryOpSubscrStrInt => 139,
            Opcode::BinaryOpSubscrTupleInt => 140,
            Opcode::BinaryOpSubtractFloat => 141,
            Opcode::BinaryOpSubtractInt => 142,
            Opcode::CallAllocAndEnterInit => 143,
            Opcode::CallBoundMethodExactArgs => 144,
            Opcode::CallBoundMethodGeneral => 145,
            Opcode::CallBuiltinClass => 146,
            Opcode::CallBuiltinFast => 147,
            Opcode::CallBuiltinFastWithKeywords => 148,
            Opcode::CallBuiltinO => 149,
            Opcode::CallIsinstance => 150,
            Opcode::CallKwBoundMethod => 151,
            Opcode::CallKwNonPy => 152,
            Opcode::CallKwPy => 153,
            Opcode::CallLen => 154,
            Opcode::CallListAppend => 155,
            Opcode::CallMethodDescriptorFast => 156,
            Opcode::CallMethodDescriptorFastWithKeywords => 157,
            Opcode::CallMethodDescriptorNoargs => 158,
            Opcode::CallMethodDescriptorO => 159,
            Opcode::CallNonPyGeneral => 160,
            Opcode::CallPyExactArgs => 161,
            Opcode::CallPyGeneral => 162,
            Opcode::CallStr1 => 163,
            Opcode::CallTuple1 => 164,
            Opcode::CallType1 => 165,
            Opcode::CompareOpFloat => 166,
            Opcode::CompareOpInt => 167,
            Opcode::CompareOpStr => 168,
            Opcode::ContainsOpDict => 169,
            Opcode::ContainsOpSet => 170,
            Opcode::ForIterGen => 171,
            Opcode::ForIterList => 172,
            Opcode::ForIterRange => 173,
            Opcode::ForIterTuple => 174,
            Opcode::JumpBackwardJit => 175,
            Opcode::JumpBackwardNoJit => 176,
            Opcode::LoadAttrClass => 177,
            Opcode::LoadAttrClassWithMetaclassCheck => 178,
            Opcode::LoadAttrGetattributeOverridden => 179,
            Opcode::LoadAttrInstanceValue => 180,
            Opcode::LoadAttrMethodLazyDict => 181,
            Opcode::LoadAttrMethodNoDict => 182,
            Opcode::LoadAttrMethodWithValues => 183,
            Opcode::LoadAttrModule => 184,
            Opcode::LoadAttrNondescriptorNoDict => 185,
            Opcode::LoadAttrNondescriptorWithValues => 186,
            Opcode::LoadAttrProperty => 187,
            Opcode::LoadAttrSlot => 188,
            Opcode::LoadAttrWithHint => 189,
            Opcode::LoadConstImmortal => 190,
            Opcode::LoadConstMortal => 191,
            Opcode::LoadGlobalBuiltin => 192,
            Opcode::LoadGlobalModule => 193,
            Opcode::LoadSuperAttrAttr => 194,
            Opcode::LoadSuperAttrMethod => 195,
            Opcode::ResumeCheck => 196,
            Opcode::SendGen => 197,
            Opcode::StoreAttrInstanceValue => 198,
            Opcode::StoreAttrSlot => 199,
            Opcode::StoreAttrWithHint => 200,
            Opcode::StoreSubscrDict => 201,
            Opcode::StoreSubscrListInt => 202,
            Opcode::ToBoolAlwaysTrue => 203,
            Opcode::ToBoolBool => 204,
            Opcode::ToBoolInt => 205,
            Opcode::ToBoolList => 206,
            Opcode::ToBoolNone => 207,
            Opcode::ToBoolStr => 208,
            Opcode::UnpackSequenceList => 209,
            Opcode::UnpackSequenceTuple => 210,
            Opcode::UnpackSequenceTwoTuple => 211,
            Opcode::InstrumentedEndFor => 234,
            Opcode::InstrumentedPopIter => 235,
            Opcode::InstrumentedEndSend => 236,
            Opcode::InstrumentedForIter => 237,
            Opcode::InstrumentedInstruction => 238,
            Opcode::InstrumentedJumpForward => 239,
            Opcode::InstrumentedNotTaken => 240,
            Opcode::InstrumentedPopJumpIfTrue => 241,
            Opcode::InstrumentedPopJumpIfFalse => 242,
            Opcode::InstrumentedPopJumpIfNone => 243,
            Opcode::InstrumentedPopJumpIfNotNone => 244,
            Opcode::InstrumentedResume => 245,
            Opcode::InstrumentedReturnValue => 246,
            Opcode::InstrumentedYieldValue => 247,
            Opcode::InstrumentedEndAsyncFor => 248,
            Opcode::InstrumentedLoadSuperAttr => 249,
            Opcode::InstrumentedCall => 250,
            Opcode::InstrumentedCallKw => 251,
            Opcode::InstrumentedCallFunctionEx => 252,
            Opcode::InstrumentedJumpBackward => 253,
            Opcode::InstrumentedLine => 254,
            Opcode::EnterExecutor => 255,
        }
    }
}

impl TryFrom<u8> for Opcode {
    type Error = crate::marshal::MarshalError;

    fn try_from(value: u8) -> Result<Self, Self::Error> {
        Ok(match value {
            0 => Self::Cache,
            1 => Self::BinarySlice,
            2 => Self::BuildTemplate,
            3 => Self::BinaryOpInplaceAddUnicode,
            4 => Self::CallFunctionEx,
            5 => Self::CheckEgMatch,
            6 => Self::CheckExcMatch,
            7 => Self::CleanupThrow,
            8 => Self::DeleteSubscr,
            9 => Self::EndFor,
            10 => Self::EndSend,
            11 => Self::ExitInitCheck,
            12 => Self::FormatSimple,
            13 => Self::FormatWithSpec,
            14 => Self::GetAIter,
            15 => Self::GetANext,
            16 => Self::GetIter,
            17 => Self::Reserved,
            18 => Self::GetLen,
            19 => Self::GetYieldFromIter,
            20 => Self::InterpreterExit,
            21 => Self::LoadBuildClass,
            22 => Self::LoadLocals,
            23 => Self::MakeFunction,
            24 => Self::MatchKeys,
            25 => Self::MatchMapping,
            26 => Self::MatchSequence,
            27 => Self::Nop,
            28 => Self::NotTaken,
            29 => Self::PopExcept,
            30 => Self::PopIter,
            31 => Self::PopTop,
            32 => Self::PushExcInfo,
            33 => Self::PushNull,
            34 => Self::ReturnGenerator,
            35 => Self::ReturnValue,
            36 => Self::SetupAnnotations,
            37 => Self::StoreSlice,
            38 => Self::StoreSubscr,
            39 => Self::ToBool,
            40 => Self::UnaryInvert,
            41 => Self::UnaryNegative,
            42 => Self::UnaryNot,
            43 => Self::WithExceptStart,
            44 => Self::BinaryOp,
            45 => Self::BuildInterpolation,
            46 => Self::BuildList,
            47 => Self::BuildMap,
            48 => Self::BuildSet,
            49 => Self::BuildSlice,
            50 => Self::BuildString,
            51 => Self::BuildTuple,
            52 => Self::Call,
            53 => Self::CallIntrinsic1,
            54 => Self::CallIntrinsic2,
            55 => Self::CallKw,
            56 => Self::CompareOp,
            57 => Self::ContainsOp,
            58 => Self::ConvertValue,
            59 => Self::Copy,
            60 => Self::CopyFreeVars,
            61 => Self::DeleteAttr,
            62 => Self::DeleteDeref,
            63 => Self::DeleteFast,
            64 => Self::DeleteGlobal,
            65 => Self::DeleteName,
            66 => Self::DictMerge,
            67 => Self::DictUpdate,
            68 => Self::EndAsyncFor,
            69 => Self::ExtendedArg,
            70 => Self::ForIter,
            71 => Self::GetAwaitable,
            72 => Self::ImportFrom,
            73 => Self::ImportName,
            74 => Self::IsOp,
            75 => Self::JumpBackward,
            76 => Self::JumpBackwardNoInterrupt,
            77 => Self::JumpForward,
            78 => Self::ListAppend,
            79 => Self::ListExtend,
            80 => Self::LoadAttr,
            81 => Self::LoadCommonConstant,
            82 => Self::LoadConst,
            83 => Self::LoadDeref,
            84 => Self::LoadFast,
            85 => Self::LoadFastAndClear,
            86 => Self::LoadFastBorrow,
            87 => Self::LoadFastBorrowLoadFastBorrow,
            88 => Self::LoadFastCheck,
            89 => Self::LoadFastLoadFast,
            90 => Self::LoadFromDictOrDeref,
            91 => Self::LoadFromDictOrGlobals,
            92 => Self::LoadGlobal,
            93 => Self::LoadName,
            94 => Self::LoadSmallInt,
            95 => Self::LoadSpecial,
            96 => Self::LoadSuperAttr,
            97 => Self::MakeCell,
            98 => Self::MapAdd,
            99 => Self::MatchClass,
            100 => Self::PopJumpIfFalse,
            101 => Self::PopJumpIfNone,
            102 => Self::PopJumpIfNotNone,
            103 => Self::PopJumpIfTrue,
            104 => Self::RaiseVarargs,
            105 => Self::Reraise,
            106 => Self::Send,
            107 => Self::SetAdd,
            108 => Self::SetFunctionAttribute,
            109 => Self::SetUpdate,
            110 => Self::StoreAttr,
            111 => Self::StoreDeref,
            112 => Self::StoreFast,
            113 => Self::StoreFastLoadFast,
            114 => Self::StoreFastStoreFast,
            115 => Self::StoreGlobal,
            116 => Self::StoreName,
            117 => Self::Swap,
            118 => Self::UnpackEx,
            119 => Self::UnpackSequence,
            120 => Self::YieldValue,
            128 => Self::Resume,
            129 => Self::BinaryOpAddFloat,
            130 => Self::BinaryOpAddInt,
            131 => Self::BinaryOpAddUnicode,
            132 => Self::BinaryOpExtend,
            133 => Self::BinaryOpMultiplyFloat,
            134 => Self::BinaryOpMultiplyInt,
            135 => Self::BinaryOpSubscrDict,
            136 => Self::BinaryOpSubscrGetitem,
            137 => Self::BinaryOpSubscrListInt,
            138 => Self::BinaryOpSubscrListSlice,
            139 => Self::BinaryOpSubscrStrInt,
            140 => Self::BinaryOpSubscrTupleInt,
            141 => Self::BinaryOpSubtractFloat,
            142 => Self::BinaryOpSubtractInt,
            143 => Self::CallAllocAndEnterInit,
            144 => Self::CallBoundMethodExactArgs,
            145 => Self::CallBoundMethodGeneral,
            146 => Self::CallBuiltinClass,
            147 => Self::CallBuiltinFast,
            148 => Self::CallBuiltinFastWithKeywords,
            149 => Self::CallBuiltinO,
            150 => Self::CallIsinstance,
            151 => Self::CallKwBoundMethod,
            152 => Self::CallKwNonPy,
            153 => Self::CallKwPy,
            154 => Self::CallLen,
            155 => Self::CallListAppend,
            156 => Self::CallMethodDescriptorFast,
            157 => Self::CallMethodDescriptorFastWithKeywords,
            158 => Self::CallMethodDescriptorNoargs,
            159 => Self::CallMethodDescriptorO,
            160 => Self::CallNonPyGeneral,
            161 => Self::CallPyExactArgs,
            162 => Self::CallPyGeneral,
            163 => Self::CallStr1,
            164 => Self::CallTuple1,
            165 => Self::CallType1,
            166 => Self::CompareOpFloat,
            167 => Self::CompareOpInt,
            168 => Self::CompareOpStr,
            169 => Self::ContainsOpDict,
            170 => Self::ContainsOpSet,
            171 => Self::ForIterGen,
            172 => Self::ForIterList,
            173 => Self::ForIterRange,
            174 => Self::ForIterTuple,
            175 => Self::JumpBackwardJit,
            176 => Self::JumpBackwardNoJit,
            177 => Self::LoadAttrClass,
            178 => Self::LoadAttrClassWithMetaclassCheck,
            179 => Self::LoadAttrGetattributeOverridden,
            180 => Self::LoadAttrInstanceValue,
            181 => Self::LoadAttrMethodLazyDict,
            182 => Self::LoadAttrMethodNoDict,
            183 => Self::LoadAttrMethodWithValues,
            184 => Self::LoadAttrModule,
            185 => Self::LoadAttrNondescriptorNoDict,
            186 => Self::LoadAttrNondescriptorWithValues,
            187 => Self::LoadAttrProperty,
            188 => Self::LoadAttrSlot,
            189 => Self::LoadAttrWithHint,
            190 => Self::LoadConstImmortal,
            191 => Self::LoadConstMortal,
            192 => Self::LoadGlobalBuiltin,
            193 => Self::LoadGlobalModule,
            194 => Self::LoadSuperAttrAttr,
            195 => Self::LoadSuperAttrMethod,
            196 => Self::ResumeCheck,
            197 => Self::SendGen,
            198 => Self::StoreAttrInstanceValue,
            199 => Self::StoreAttrSlot,
            200 => Self::StoreAttrWithHint,
            201 => Self::StoreSubscrDict,
            202 => Self::StoreSubscrListInt,
            203 => Self::ToBoolAlwaysTrue,
            204 => Self::ToBoolBool,
            205 => Self::ToBoolInt,
            206 => Self::ToBoolList,
            207 => Self::ToBoolNone,
            208 => Self::ToBoolStr,
            209 => Self::UnpackSequenceList,
            210 => Self::UnpackSequenceTuple,
            211 => Self::UnpackSequenceTwoTuple,
            234 => Self::InstrumentedEndFor,
            235 => Self::InstrumentedPopIter,
            236 => Self::InstrumentedEndSend,
            237 => Self::InstrumentedForIter,
            238 => Self::InstrumentedInstruction,
            239 => Self::InstrumentedJumpForward,
            240 => Self::InstrumentedNotTaken,
            241 => Self::InstrumentedPopJumpIfTrue,
            242 => Self::InstrumentedPopJumpIfFalse,
            243 => Self::InstrumentedPopJumpIfNone,
            244 => Self::InstrumentedPopJumpIfNotNone,
            245 => Self::InstrumentedResume,
            246 => Self::InstrumentedReturnValue,
            247 => Self::InstrumentedYieldValue,
            248 => Self::InstrumentedEndAsyncFor,
            249 => Self::InstrumentedLoadSuperAttr,
            250 => Self::InstrumentedCall,
            251 => Self::InstrumentedCallKw,
            252 => Self::InstrumentedCallFunctionEx,
            253 => Self::InstrumentedJumpBackward,
            254 => Self::InstrumentedLine,
            255 => Self::EnterExecutor,
            _ => return Err(Self::Error::InvalidBytecode),
        })
    }
}

#[derive(Clone, Copy, Debug, Eq, PartialEq)]
pub enum PseudoOpcode {
    AnnotationsPlaceholder,
    Jump,
    JumpIfFalse,
    JumpIfTrue,
    JumpNoInterrupt,
    LoadClosure,
    PopBlock,
    SetupCleanup,
    SetupFinally,
    SetupWith,
    StoreFastMaybeNull,
}

impl PseudoOpcode {
    /// Whether opcode ID have 'HAS_ARG_FLAG' set.
    #[must_use]
    pub const fn has_arg(self) -> bool {
        matches!(
            self,
            Self::Jump
                | Self::JumpIfFalse
                | Self::JumpIfTrue
                | Self::JumpNoInterrupt
                | Self::LoadClosure
                | Self::StoreFastMaybeNull
        )
    }

    /// Whether opcode ID have 'HAS_CONST_FLAG' set.
    #[must_use]
    pub const fn has_const(self) -> bool {
        false
    }

    /// Whether opcode ID have 'HAS_PURE_FLAG' set.
    #[must_use]
    pub const fn has_exc(self) -> bool {
        matches!(
            self,
            Self::AnnotationsPlaceholder
                | Self::LoadClosure
                | Self::PopBlock
                | Self::SetupCleanup
                | Self::SetupFinally
                | Self::SetupWith
        )
    }

    /// Whether opcode ID have 'HAS_JUMP_FLAG' set.
    #[must_use]
    pub const fn has_jump(self) -> bool {
        matches!(
            self,
            Self::Jump | Self::JumpIfFalse | Self::JumpIfTrue | Self::JumpNoInterrupt
        )
    }

    /// Whether opcode ID have 'HAS_LOCAL_FLAG' set.
    #[must_use]
    pub const fn has_local(self) -> bool {
        matches!(self, Self::LoadClosure | Self::StoreFastMaybeNull)
    }

    /// Whether opcode ID have 'HAS_NAME_FLAG' set.
    #[must_use]
    pub const fn has_name(self) -> bool {
        false
    }
}

impl fmt::Display for PseudoOpcode {
    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
        let name = match self {
            Self::AnnotationsPlaceholder => "ANNOTATIONS_PLACEHOLDER",
            Self::Jump => "JUMP",
            Self::JumpIfFalse => "JUMP_IF_FALSE",
            Self::JumpIfTrue => "JUMP_IF_TRUE",
            Self::JumpNoInterrupt => "JUMP_NO_INTERRUPT",
            Self::LoadClosure => "LOAD_CLOSURE",
            Self::PopBlock => "POP_BLOCK",
            Self::SetupCleanup => "SETUP_CLEANUP",
            Self::SetupFinally => "SETUP_FINALLY",
            Self::SetupWith => "SETUP_WITH",
            Self::StoreFastMaybeNull => "STORE_FAST_MAYBE_NULL",
        };
        write!(f, "{name}")
    }
}

impl From<PseudoOpcode> for u16 {
    fn from(value: PseudoOpcode) -> Self {
        match value {
            PseudoOpcode::AnnotationsPlaceholder => 256,
            PseudoOpcode::Jump => 257,
            PseudoOpcode::JumpIfFalse => 258,
            PseudoOpcode::JumpIfTrue => 259,
            PseudoOpcode::JumpNoInterrupt => 260,
            PseudoOpcode::LoadClosure => 261,
            PseudoOpcode::PopBlock => 262,
            PseudoOpcode::SetupCleanup => 263,
            PseudoOpcode::SetupFinally => 264,
            PseudoOpcode::SetupWith => 265,
            PseudoOpcode::StoreFastMaybeNull => 266,
        }
    }
}

impl TryFrom<u16> for PseudoOpcode {
    type Error = crate::marshal::MarshalError;

    fn try_from(value: u16) -> Result<Self, Self::Error> {
        Ok(match value {
            256 => Self::AnnotationsPlaceholder,
            257 => Self::Jump,
            258 => Self::JumpIfFalse,
            259 => Self::JumpIfTrue,
            260 => Self::JumpNoInterrupt,
            261 => Self::LoadClosure,
            262 => Self::PopBlock,
            263 => Self::SetupCleanup,
            264 => Self::SetupFinally,
            265 => Self::SetupWith,
            266 => Self::StoreFastMaybeNull,
            _ => return Err(Self::Error::InvalidBytecode),
        })
    }
}

#[derive(Clone, Copy, Debug)]
pub enum Instruction {
    Cache,
    BinarySlice,
    BuildTemplate,
    BinaryOpInplaceAddUnicode,
    CallFunctionEx,
    CheckEgMatch,
    CheckExcMatch,
    CleanupThrow,
    DeleteSubscr,
    EndFor,
    EndSend,
    ExitInitCheck, // Placeholder
    FormatSimple,
    FormatWithSpec,
    GetAIter,
    GetANext,
    GetIter,
    Reserved,
    GetLen,
    GetYieldFromIter,
    InterpreterExit, // Placeholder
    LoadBuildClass,
    LoadLocals,
    MakeFunction,
    MatchKeys,
    MatchMapping,
    MatchSequence,
    Nop,
    NotTaken,
    PopExcept,
    PopIter,
    PopTop,
    PushExcInfo,
    PushNull,
    ReturnGenerator,
    ReturnValue,
    SetupAnnotations,
    StoreSlice,
    StoreSubscr,
    ToBool,
    UnaryInvert,
    UnaryNegative,
    UnaryNot,
    WithExceptStart,
    BinaryOp { op: oparg::BinaryOperator },
    BuildInterpolation { oparg: u32 },
    BuildList { size: u32 },
    BuildMap { size: u32 },
    BuildSet { size: u32 },
    BuildSlice { argc: oparg::BuildSliceArgCount },
    BuildString { size: u32 },
    BuildTuple { size: u32 },
    Call { nargs: u32 },
    CallIntrinsic1 { func: oparg::IntrinsicFunction1 },
    CallIntrinsic2 { func: oparg::IntrinsicFunction2 },
    CallKw { nargs: u32 },
    CompareOp { op: oparg::ComparisonOperator },
    ContainsOp(oparg::Invert),
    ConvertValue { oparg: oparg::ConvertValueOparg },
    Copy { index: u32 },
    CopyFreeVars { count: u32 },
    DeleteAttr { idx: oparg::NameIdx },
    DeleteDeref(oparg::NameIdx),
    DeleteFast(oparg::NameIdx),
    DeleteGlobal(oparg::NameIdx),
    DeleteName(oparg::NameIdx),
    DictMerge { index: u32 },
    DictUpdate { index: u32 },
    EndAsyncFor,
    ExtendedArg,
    ForIter { target: oparg::Label },
    GetAwaitable { arg: u32 },
    ImportFrom { idx: oparg::NameIdx },
    ImportName { idx: oparg::NameIdx },
    IsOp(oparg::Invert),
    JumpBackward { target: oparg::Label },
    JumpBackwardNoInterrupt { target: oparg::Label }, // Placeholder
    JumpForward { target: oparg::Label },
    ListAppend { i: u32 },
    ListExtend { i: u32 },
    LoadAttr { idx: oparg::LoadAttr },
    LoadCommonConstant { idx: oparg::CommonConstant },
    LoadConst { idx: u32 },
    LoadDeref(oparg::NameIdx),
    LoadFast(oparg::NameIdx),
    LoadFastAndClear(oparg::NameIdx),
    LoadFastBorrow(oparg::NameIdx),
    LoadFastBorrowLoadFastBorrow { arg: u32 },
    LoadFastCheck(oparg::NameIdx),
    LoadFastLoadFast { arg: u32 },
    LoadFromDictOrDeref(oparg::NameIdx),
    LoadFromDictOrGlobals(oparg::NameIdx),
    LoadGlobal(oparg::NameIdx),
    LoadName(oparg::NameIdx),
    LoadSmallInt { idx: u32 },
    LoadSpecial { method: oparg::SpecialMethod },
    LoadSuperAttr { arg: oparg::LoadSuperAttr },
    MakeCell(oparg::NameIdx),
    MapAdd { i: u32 },
    MatchClass(u32),
    PopJumpIfFalse { target: oparg::Label },
    PopJumpIfNone { target: oparg::Label },
    PopJumpIfNotNone { target: oparg::Label },
    PopJumpIfTrue { target: oparg::Label },
    RaiseVarargs { kind: oparg::RaiseKind },
    Reraise { depth: u32 },
    Send { target: oparg::Label },
    SetAdd { i: u32 },
    SetFunctionAttribute { attr: oparg::MakeFunctionFlags },
    SetUpdate { i: u32 },
    StoreAttr { idx: oparg::NameIdx },
    StoreDeref(oparg::NameIdx),
    StoreFast(oparg::NameIdx),
    StoreFastLoadFast { var_nums: oparg::NameIdx },
    StoreFastStoreFast { arg: u32 },
    StoreGlobal(oparg::NameIdx),
    StoreName(oparg::NameIdx),
    Swap { index: u32 },
    UnpackEx { args: oparg::UnpackExArgs },
    UnpackSequence { size: u32 },
    YieldValue { arg: u32 },
    Resume { arg: u32 },
    BinaryOpAddFloat,                     // Placeholder
    BinaryOpAddInt,                       // Placeholder
    BinaryOpAddUnicode,                   // Placeholder
    BinaryOpExtend,                       // Placeholder
    BinaryOpMultiplyFloat,                // Placeholder
    BinaryOpMultiplyInt,                  // Placeholder
    BinaryOpSubscrDict,                   // Placeholder
    BinaryOpSubscrGetitem,                // Placeholder
    BinaryOpSubscrListInt,                // Placeholder
    BinaryOpSubscrListSlice,              // Placeholder
    BinaryOpSubscrStrInt,                 // Placeholder
    BinaryOpSubscrTupleInt,               // Placeholder
    BinaryOpSubtractFloat,                // Placeholder
    BinaryOpSubtractInt,                  // Placeholder
    CallAllocAndEnterInit,                // Placeholder
    CallBoundMethodExactArgs,             // Placeholder
    CallBoundMethodGeneral,               // Placeholder
    CallBuiltinClass,                     // Placeholder
    CallBuiltinFast,                      // Placeholder
    CallBuiltinFastWithKeywords,          // Placeholder
    CallBuiltinO,                         // Placeholder
    CallIsinstance,                       // Placeholder
    CallKwBoundMethod,                    // Placeholder
    CallKwNonPy,                          // Placeholder
    CallKwPy,                             // Placeholder
    CallLen,                              // Placeholder
    CallListAppend,                       // Placeholder
    CallMethodDescriptorFast,             // Placeholder
    CallMethodDescriptorFastWithKeywords, // Placeholder
    CallMethodDescriptorNoargs,           // Placeholder
    CallMethodDescriptorO,                // Placeholder
    CallNonPyGeneral,                     // Placeholder
    CallPyExactArgs,                      // Placeholder
    CallPyGeneral,                        // Placeholder
    CallStr1,                             // Placeholder
    CallTuple1,                           // Placeholder
    CallType1,                            // Placeholder
    CompareOpFloat,                       // Placeholder
    CompareOpInt,                         // Placeholder
    CompareOpStr,                         // Placeholder
    ContainsOpDict,                       // Placeholder
    ContainsOpSet,                        // Placeholder
    ForIterGen,                           // Placeholder
    ForIterList,                          // Placeholder
    ForIterRange,                         // Placeholder
    ForIterTuple,                         // Placeholder
    JumpBackwardJit,                      // Placeholder
    JumpBackwardNoJit,                    // Placeholder
    LoadAttrClass,                        // Placeholder
    LoadAttrClassWithMetaclassCheck,      // Placeholder
    LoadAttrGetattributeOverridden,       // Placeholder
    LoadAttrInstanceValue,                // Placeholder
    LoadAttrMethodLazyDict,               // Placeholder
    LoadAttrMethodNoDict,                 // Placeholder
    LoadAttrMethodWithValues,             // Placeholder
    LoadAttrModule,                       // Placeholder
    LoadAttrNondescriptorNoDict,          // Placeholder
    LoadAttrNondescriptorWithValues,      // Placeholder
    LoadAttrProperty,                     // Placeholder
    LoadAttrSlot,                         // Placeholder
    LoadAttrWithHint,                     // Placeholder
    LoadConstImmortal,                    // Placeholder
    LoadConstMortal,                      // Placeholder
    LoadGlobalBuiltin,                    // Placeholder
    LoadGlobalModule,                     // Placeholder
    LoadSuperAttrAttr,                    // Placeholder
    LoadSuperAttrMethod,                  // Placeholder
    ResumeCheck,                          // Placeholder
    SendGen,                              // Placeholder
    StoreAttrInstanceValue,               // Placeholder
    StoreAttrSlot,                        // Placeholder
    StoreAttrWithHint,                    // Placeholder
    StoreSubscrDict,                      // Placeholder
    StoreSubscrListInt,                   // Placeholder
    ToBoolAlwaysTrue,                     // Placeholder
    ToBoolBool,                           // Placeholder
    ToBoolInt,                            // Placeholder
    ToBoolList,                           // Placeholder
    ToBoolNone,                           // Placeholder
    ToBoolStr,                            // Placeholder
    UnpackSequenceList,                   // Placeholder
    UnpackSequenceTuple,                  // Placeholder
    UnpackSequenceTwoTuple,               // Placeholder
    InstrumentedEndFor,                   // Placeholder
    InstrumentedPopIter,                  // Placeholder
    InstrumentedEndSend,                  // Placeholder
    InstrumentedForIter,                  // Placeholder
    InstrumentedInstruction,              // Placeholder
    InstrumentedJumpForward,              // Placeholder
    InstrumentedNotTaken,                 // Placeholder
    InstrumentedPopJumpIfTrue,            // Placeholder
    InstrumentedPopJumpIfFalse,           // Placeholder
    InstrumentedPopJumpIfNone,            // Placeholder
    InstrumentedPopJumpIfNotNone,         // Placeholder
    InstrumentedResume,                   // Placeholder
    InstrumentedReturnValue,              // Placeholder
    InstrumentedYieldValue,               // Placeholder
    InstrumentedEndAsyncFor,              // Placeholder
    InstrumentedLoadSuperAttr,            // Placeholder
    InstrumentedCall,                     // Placeholder
    InstrumentedCallKw,                   // Placeholder
    InstrumentedCallFunctionEx,           // Placeholder
    InstrumentedJumpBackward,             // Placeholder
    InstrumentedLine,                     // Placeholder
    EnterExecutor,                        // Placeholder
}

impl Instruction {
    pub fn fmt_dis(
        self,
        f: &mut fmt::Formatter<'_>,
        ctx: &impl InstrDisplayContext,
        expand_code_objects: bool,
        pad: usize,
        level: usize,
    ) -> fmt::Result {
        let opcode = self.opcode();

        match self {
            Self::Cache => write!(f, "{opcode}"),
            Self::BinarySlice => write!(f, "{opcode}"),
            Self::BuildTemplate => write!(f, "{opcode}"),
            Self::BinaryOpInplaceAddUnicode => write!(f, "{opcode}"),
            Self::CallFunctionEx => write!(f, "{opcode}"),
            Self::CheckEgMatch => write!(f, "{opcode}"),
            Self::CheckExcMatch => write!(f, "{opcode}"),
            Self::CleanupThrow => write!(f, "{opcode}"),
            Self::DeleteSubscr => write!(f, "{opcode}"),
            Self::EndFor => write!(f, "{opcode}"),
            Self::EndSend => write!(f, "{opcode}"),
            Self::ExitInitCheck => write!(f, "{opcode}"),
            Self::FormatSimple => write!(f, "{opcode}"),
            Self::FormatWithSpec => write!(f, "{opcode}"),
            Self::GetAIter => write!(f, "{opcode}"),
            Self::GetANext => write!(f, "{opcode}"),
            Self::GetIter => write!(f, "{opcode}"),
            Self::Reserved => write!(f, "{opcode}"),
            Self::GetLen => write!(f, "{opcode}"),
            Self::GetYieldFromIter => write!(f, "{opcode}"),
            Self::InterpreterExit => write!(f, "{opcode}"),
            Self::LoadBuildClass => write!(f, "{opcode}"),
            Self::LoadLocals => write!(f, "{opcode}"),
            Self::MakeFunction => write!(f, "{opcode}"),
            Self::MatchKeys => write!(f, "{opcode}"),
            Self::MatchMapping => write!(f, "{opcode}"),
            Self::MatchSequence => write!(f, "{opcode}"),
            Self::Nop => write!(f, "{opcode}"),
            Self::NotTaken => write!(f, "{opcode}"),
            Self::PopExcept => write!(f, "{opcode}"),
            Self::PopIter => write!(f, "{opcode}"),
            Self::PopTop => write!(f, "{opcode}"),
            Self::PushExcInfo => write!(f, "{opcode}"),
            Self::PushNull => write!(f, "{opcode}"),
            Self::ReturnGenerator => write!(f, "{opcode}"),
            Self::ReturnValue => write!(f, "{opcode}"),
            Self::SetupAnnotations => write!(f, "{opcode}"),
            Self::StoreSlice => write!(f, "{opcode}"),
            Self::StoreSubscr => write!(f, "{opcode}"),
            Self::ToBool => write!(f, "{opcode}"),
            Self::UnaryInvert => write!(f, "{opcode}"),
            Self::UnaryNegative => write!(f, "{opcode}"),
            Self::UnaryNot => write!(f, "{opcode}"),
            Self::WithExceptStart => write!(f, "{opcode}"),
            Self::BinaryOp { op } => write!(f, "{:pad$}({})", opcode, op),
            Self::BuildInterpolation { oparg } => write!(f, "{:pad$}({})", opcode, oparg),
            Self::BuildList { size } => write!(f, "{:pad$}({})", opcode, size),
            Self::BuildMap { size } => write!(f, "{:pad$}({})", opcode, size),
            Self::BuildSet { size } => write!(f, "{:pad$}({})", opcode, size),
            Self::BuildSlice { argc } => write!(f, "{:pad$}({:?})", opcode, argc),
            Self::BuildString { size } => write!(f, "{:pad$}({})", opcode, size),
            Self::BuildTuple { size } => write!(f, "{:pad$}({})", opcode, size),
            Self::Call { nargs } => write!(f, "{:pad$}({})", opcode, nargs),
            Self::CallIntrinsic1 { func } => write!(f, "{:pad$}({:?})", opcode, func),
            Self::CallIntrinsic2 { func } => write!(f, "{:pad$}({:?})", opcode, func),
            Self::CallKw { nargs } => write!(f, "{:pad$}({})", opcode, nargs),
            Self::CompareOp { op } => write!(f, "{:pad$}({:?})", opcode, op),
            Self::ContainsOp(oparg) => write!(f, "{:pad$}({:?})", opcode, oparg),
            Self::ConvertValue { oparg } => write!(f, "{:pad$}({})", opcode, oparg),
            Self::Copy { index } => write!(f, "{:pad$}({})", opcode, index),
            Self::CopyFreeVars { count } => write!(f, "{:pad$}({})", opcode, count),
            Self::DeleteAttr { idx } => {
                let oparg_val = usize::from(u32::from(idx));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_name(oparg_val)
                )
            }
            Self::DeleteDeref(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_cell_name(oparg_val)
                )
            }
            Self::DeleteFast(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_varname(oparg_val)
                )
            }
            Self::DeleteGlobal(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_name(oparg_val)
                )
            }
            Self::DeleteName(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_name(oparg_val)
                )
            }
            Self::DictMerge { index } => write!(f, "{:pad$}({})", opcode, index),
            Self::DictUpdate { index } => write!(f, "{:pad$}({})", opcode, index),
            Self::EndAsyncFor => write!(f, "{opcode}"),
            Self::ExtendedArg => write!(f, "{opcode}"),
            Self::ForIter { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::GetAwaitable { arg } => write!(f, "{:pad$}({})", opcode, arg),
            Self::ImportFrom { idx } => {
                let oparg_val = usize::from(u32::from(idx));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_name(oparg_val)
                )
            }
            Self::ImportName { idx } => {
                let oparg_val = usize::from(u32::from(idx));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_name(oparg_val)
                )
            }
            Self::IsOp(oparg) => write!(f, "{:pad$}({:?})", opcode, oparg),
            Self::JumpBackward { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::JumpBackwardNoInterrupt { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::JumpForward { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::ListAppend { i } => write!(f, "{:pad$}({})", opcode, i),
            Self::ListExtend { i } => write!(f, "{:pad$}({})", opcode, i),
            Self::LoadAttr { idx } => write!(f, "{:pad$}({})", opcode, idx),
            Self::LoadCommonConstant { idx } => write!(f, "{:pad$}({})", opcode, idx),
            Self::LoadConst { idx } => write!(f, "{:pad$}({})", opcode, idx),
            Self::LoadDeref(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_cell_name(oparg_val)
                )
            }
            Self::LoadFast(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_varname(oparg_val)
                )
            }
            Self::LoadFastAndClear(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_varname(oparg_val)
                )
            }
            Self::LoadFastBorrow(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_varname(oparg_val)
                )
            }
            Self::LoadFastBorrowLoadFastBorrow { arg } => write!(f, "{:pad$}({})", opcode, arg),
            Self::LoadFastCheck(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_varname(oparg_val)
                )
            }
            Self::LoadFastLoadFast { arg } => write!(f, "{:pad$}({})", opcode, arg),
            Self::LoadFromDictOrDeref(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_cell_name(oparg_val)
                )
            }
            Self::LoadFromDictOrGlobals(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_name(oparg_val)
                )
            }
            Self::LoadGlobal(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_name(oparg_val)
                )
            }
            Self::LoadName(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_name(oparg_val)
                )
            }
            Self::LoadSmallInt { idx } => write!(f, "{:pad$}({})", opcode, idx),
            Self::LoadSpecial { method } => write!(f, "{:pad$}({})", opcode, method),
            Self::LoadSuperAttr { arg } => write!(f, "{:pad$}({})", opcode, arg),
            Self::MakeCell(oparg) => write!(f, "{:pad$}({})", opcode, oparg),
            Self::MapAdd { i } => write!(f, "{:pad$}({})", opcode, i),
            Self::MatchClass(oparg) => write!(f, "{:pad$}({})", opcode, oparg),
            Self::PopJumpIfFalse { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::PopJumpIfNone { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::PopJumpIfNotNone { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::PopJumpIfTrue { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::RaiseVarargs { kind } => write!(f, "{:pad$}({:?})", opcode, kind),
            Self::Reraise { depth } => write!(f, "{:pad$}({})", opcode, depth),
            Self::Send { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::SetAdd { i } => write!(f, "{:pad$}({})", opcode, i),
            Self::SetFunctionAttribute { attr } => write!(f, "{:pad$}({:?})", opcode, attr),
            Self::SetUpdate { i } => write!(f, "{:pad$}({})", opcode, i),
            Self::StoreAttr { idx } => {
                let oparg_val = usize::from(u32::from(idx));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_name(oparg_val)
                )
            }
            Self::StoreDeref(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_cell_name(oparg_val)
                )
            }
            Self::StoreFast(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_varname(oparg_val)
                )
            }
            Self::StoreFastLoadFast { var_nums } => write!(f, "{:pad$}({})", opcode, var_nums),
            Self::StoreFastStoreFast { arg } => write!(f, "{:pad$}({})", opcode, arg),
            Self::StoreGlobal(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_name(oparg_val)
                )
            }
            Self::StoreName(oparg) => {
                let oparg_val = usize::from(u32::from(oparg));
                write!(
                    f,
                    "{:pad$}({}, {})",
                    opcode,
                    oparg_val,
                    ctx.get_name(oparg_val)
                )
            }
            Self::Swap { index } => write!(f, "{:pad$}({})", opcode, index),
            Self::UnpackEx { args } => write!(f, "{:pad$}({})", opcode, args),
            Self::UnpackSequence { size } => write!(f, "{:pad$}({})", opcode, size),
            Self::YieldValue { arg } => write!(f, "{:pad$}({})", opcode, arg),
            Self::Resume { arg } => write!(f, "{:pad$}({})", opcode, arg),
            Self::BinaryOpAddFloat => write!(f, "{opcode}"),
            Self::BinaryOpAddInt => write!(f, "{opcode}"),
            Self::BinaryOpAddUnicode => write!(f, "{opcode}"),
            Self::BinaryOpExtend => write!(f, "{opcode}"),
            Self::BinaryOpMultiplyFloat => write!(f, "{opcode}"),
            Self::BinaryOpMultiplyInt => write!(f, "{opcode}"),
            Self::BinaryOpSubscrDict => write!(f, "{opcode}"),
            Self::BinaryOpSubscrGetitem => write!(f, "{opcode}"),
            Self::BinaryOpSubscrListInt => write!(f, "{opcode}"),
            Self::BinaryOpSubscrListSlice => write!(f, "{opcode}"),
            Self::BinaryOpSubscrStrInt => write!(f, "{opcode}"),
            Self::BinaryOpSubscrTupleInt => write!(f, "{opcode}"),
            Self::BinaryOpSubtractFloat => write!(f, "{opcode}"),
            Self::BinaryOpSubtractInt => write!(f, "{opcode}"),
            Self::CallAllocAndEnterInit => write!(f, "{opcode}"),
            Self::CallBoundMethodExactArgs => write!(f, "{opcode}"),
            Self::CallBoundMethodGeneral => write!(f, "{opcode}"),
            Self::CallBuiltinClass => write!(f, "{opcode}"),
            Self::CallBuiltinFast => write!(f, "{opcode}"),
            Self::CallBuiltinFastWithKeywords => write!(f, "{opcode}"),
            Self::CallBuiltinO => write!(f, "{opcode}"),
            Self::CallIsinstance => write!(f, "{opcode}"),
            Self::CallKwBoundMethod => write!(f, "{opcode}"),
            Self::CallKwNonPy => write!(f, "{opcode}"),
            Self::CallKwPy => write!(f, "{opcode}"),
            Self::CallLen => write!(f, "{opcode}"),
            Self::CallListAppend => write!(f, "{opcode}"),
            Self::CallMethodDescriptorFast => write!(f, "{opcode}"),
            Self::CallMethodDescriptorFastWithKeywords => write!(f, "{opcode}"),
            Self::CallMethodDescriptorNoargs => write!(f, "{opcode}"),
            Self::CallMethodDescriptorO => write!(f, "{opcode}"),
            Self::CallNonPyGeneral => write!(f, "{opcode}"),
            Self::CallPyExactArgs => write!(f, "{opcode}"),
            Self::CallPyGeneral => write!(f, "{opcode}"),
            Self::CallStr1 => write!(f, "{opcode}"),
            Self::CallTuple1 => write!(f, "{opcode}"),
            Self::CallType1 => write!(f, "{opcode}"),
            Self::CompareOpFloat => write!(f, "{opcode}"),
            Self::CompareOpInt => write!(f, "{opcode}"),
            Self::CompareOpStr => write!(f, "{opcode}"),
            Self::ContainsOpDict => write!(f, "{opcode}"),
            Self::ContainsOpSet => write!(f, "{opcode}"),
            Self::ForIterGen => write!(f, "{opcode}"),
            Self::ForIterList => write!(f, "{opcode}"),
            Self::ForIterRange => write!(f, "{opcode}"),
            Self::ForIterTuple => write!(f, "{opcode}"),
            Self::JumpBackwardJit => write!(f, "{opcode}"),
            Self::JumpBackwardNoJit => write!(f, "{opcode}"),
            Self::LoadAttrClass => write!(f, "{opcode}"),
            Self::LoadAttrClassWithMetaclassCheck => write!(f, "{opcode}"),
            Self::LoadAttrGetattributeOverridden => write!(f, "{opcode}"),
            Self::LoadAttrInstanceValue => write!(f, "{opcode}"),
            Self::LoadAttrMethodLazyDict => write!(f, "{opcode}"),
            Self::LoadAttrMethodNoDict => write!(f, "{opcode}"),
            Self::LoadAttrMethodWithValues => write!(f, "{opcode}"),
            Self::LoadAttrModule => write!(f, "{opcode}"),
            Self::LoadAttrNondescriptorNoDict => write!(f, "{opcode}"),
            Self::LoadAttrNondescriptorWithValues => write!(f, "{opcode}"),
            Self::LoadAttrProperty => write!(f, "{opcode}"),
            Self::LoadAttrSlot => write!(f, "{opcode}"),
            Self::LoadAttrWithHint => write!(f, "{opcode}"),
            Self::LoadConstImmortal => write!(f, "{opcode}"),
            Self::LoadConstMortal => write!(f, "{opcode}"),
            Self::LoadGlobalBuiltin => write!(f, "{opcode}"),
            Self::LoadGlobalModule => write!(f, "{opcode}"),
            Self::LoadSuperAttrAttr => write!(f, "{opcode}"),
            Self::LoadSuperAttrMethod => write!(f, "{opcode}"),
            Self::ResumeCheck => write!(f, "{opcode}"),
            Self::SendGen => write!(f, "{opcode}"),
            Self::StoreAttrInstanceValue => write!(f, "{opcode}"),
            Self::StoreAttrSlot => write!(f, "{opcode}"),
            Self::StoreAttrWithHint => write!(f, "{opcode}"),
            Self::StoreSubscrDict => write!(f, "{opcode}"),
            Self::StoreSubscrListInt => write!(f, "{opcode}"),
            Self::ToBoolAlwaysTrue => write!(f, "{opcode}"),
            Self::ToBoolBool => write!(f, "{opcode}"),
            Self::ToBoolInt => write!(f, "{opcode}"),
            Self::ToBoolList => write!(f, "{opcode}"),
            Self::ToBoolNone => write!(f, "{opcode}"),
            Self::ToBoolStr => write!(f, "{opcode}"),
            Self::UnpackSequenceList => write!(f, "{opcode}"),
            Self::UnpackSequenceTuple => write!(f, "{opcode}"),
            Self::UnpackSequenceTwoTuple => write!(f, "{opcode}"),
            Self::InstrumentedEndFor => write!(f, "{opcode}"),
            Self::InstrumentedPopIter => write!(f, "{opcode}"),
            Self::InstrumentedEndSend => write!(f, "{opcode}"),
            Self::InstrumentedForIter => write!(f, "{opcode}"),
            Self::InstrumentedInstruction => write!(f, "{opcode}"),
            Self::InstrumentedJumpForward => write!(f, "{opcode}"),
            Self::InstrumentedNotTaken => write!(f, "{opcode}"),
            Self::InstrumentedPopJumpIfTrue => write!(f, "{opcode}"),
            Self::InstrumentedPopJumpIfFalse => write!(f, "{opcode}"),
            Self::InstrumentedPopJumpIfNone => write!(f, "{opcode}"),
            Self::InstrumentedPopJumpIfNotNone => write!(f, "{opcode}"),
            Self::InstrumentedResume => write!(f, "{opcode}"),
            Self::InstrumentedReturnValue => write!(f, "{opcode}"),
            Self::InstrumentedYieldValue => write!(f, "{opcode}"),
            Self::InstrumentedEndAsyncFor => write!(f, "{opcode}"),
            Self::InstrumentedLoadSuperAttr => write!(f, "{opcode}"),
            Self::InstrumentedCall => write!(f, "{opcode}"),
            Self::InstrumentedCallKw => write!(f, "{opcode}"),
            Self::InstrumentedCallFunctionEx => write!(f, "{opcode}"),
            Self::InstrumentedJumpBackward => write!(f, "{opcode}"),
            Self::InstrumentedLine => write!(f, "{opcode}"),
            Self::EnterExecutor => write!(f, "{opcode}"),
        }
    }

    /// Instruction's opcode.
    #[must_use]
    pub const fn opcode(self) -> Opcode {
        match self {
            Self::Cache => Opcode::Cache,
            Self::BinarySlice => Opcode::BinarySlice,
            Self::BuildTemplate => Opcode::BuildTemplate,
            Self::BinaryOpInplaceAddUnicode => Opcode::BinaryOpInplaceAddUnicode,
            Self::CallFunctionEx => Opcode::CallFunctionEx,
            Self::CheckEgMatch => Opcode::CheckEgMatch,
            Self::CheckExcMatch => Opcode::CheckExcMatch,
            Self::CleanupThrow => Opcode::CleanupThrow,
            Self::DeleteSubscr => Opcode::DeleteSubscr,
            Self::EndFor => Opcode::EndFor,
            Self::EndSend => Opcode::EndSend,
            Self::ExitInitCheck => Opcode::ExitInitCheck,
            Self::FormatSimple => Opcode::FormatSimple,
            Self::FormatWithSpec => Opcode::FormatWithSpec,
            Self::GetAIter => Opcode::GetAIter,
            Self::GetANext => Opcode::GetANext,
            Self::GetIter => Opcode::GetIter,
            Self::Reserved => Opcode::Reserved,
            Self::GetLen => Opcode::GetLen,
            Self::GetYieldFromIter => Opcode::GetYieldFromIter,
            Self::InterpreterExit => Opcode::InterpreterExit,
            Self::LoadBuildClass => Opcode::LoadBuildClass,
            Self::LoadLocals => Opcode::LoadLocals,
            Self::MakeFunction => Opcode::MakeFunction,
            Self::MatchKeys => Opcode::MatchKeys,
            Self::MatchMapping => Opcode::MatchMapping,
            Self::MatchSequence => Opcode::MatchSequence,
            Self::Nop => Opcode::Nop,
            Self::NotTaken => Opcode::NotTaken,
            Self::PopExcept => Opcode::PopExcept,
            Self::PopIter => Opcode::PopIter,
            Self::PopTop => Opcode::PopTop,
            Self::PushExcInfo => Opcode::PushExcInfo,
            Self::PushNull => Opcode::PushNull,
            Self::ReturnGenerator => Opcode::ReturnGenerator,
            Self::ReturnValue => Opcode::ReturnValue,
            Self::SetupAnnotations => Opcode::SetupAnnotations,
            Self::StoreSlice => Opcode::StoreSlice,
            Self::StoreSubscr => Opcode::StoreSubscr,
            Self::ToBool => Opcode::ToBool,
            Self::UnaryInvert => Opcode::UnaryInvert,
            Self::UnaryNegative => Opcode::UnaryNegative,
            Self::UnaryNot => Opcode::UnaryNot,
            Self::WithExceptStart => Opcode::WithExceptStart,
            Self::BinaryOp { .. } => Opcode::BinaryOp,
            Self::BuildInterpolation { .. } => Opcode::BuildInterpolation,
            Self::BuildList { .. } => Opcode::BuildList,
            Self::BuildMap { .. } => Opcode::BuildMap,
            Self::BuildSet { .. } => Opcode::BuildSet,
            Self::BuildSlice { .. } => Opcode::BuildSlice,
            Self::BuildString { .. } => Opcode::BuildString,
            Self::BuildTuple { .. } => Opcode::BuildTuple,
            Self::Call { .. } => Opcode::Call,
            Self::CallIntrinsic1 { .. } => Opcode::CallIntrinsic1,
            Self::CallIntrinsic2 { .. } => Opcode::CallIntrinsic2,
            Self::CallKw { .. } => Opcode::CallKw,
            Self::CompareOp { .. } => Opcode::CompareOp,
            Self::ContainsOp(_) => Opcode::ContainsOp,
            Self::ConvertValue { .. } => Opcode::ConvertValue,
            Self::Copy { .. } => Opcode::Copy,
            Self::CopyFreeVars { .. } => Opcode::CopyFreeVars,
            Self::DeleteAttr { .. } => Opcode::DeleteAttr,
            Self::DeleteDeref(_) => Opcode::DeleteDeref,
            Self::DeleteFast(_) => Opcode::DeleteFast,
            Self::DeleteGlobal(_) => Opcode::DeleteGlobal,
            Self::DeleteName(_) => Opcode::DeleteName,
            Self::DictMerge { .. } => Opcode::DictMerge,
            Self::DictUpdate { .. } => Opcode::DictUpdate,
            Self::EndAsyncFor => Opcode::EndAsyncFor,
            Self::ExtendedArg => Opcode::ExtendedArg,
            Self::ForIter { .. } => Opcode::ForIter,
            Self::GetAwaitable { .. } => Opcode::GetAwaitable,
            Self::ImportFrom { .. } => Opcode::ImportFrom,
            Self::ImportName { .. } => Opcode::ImportName,
            Self::IsOp(_) => Opcode::IsOp,
            Self::JumpBackward { .. } => Opcode::JumpBackward,
            Self::JumpBackwardNoInterrupt { .. } => Opcode::JumpBackwardNoInterrupt,
            Self::JumpForward { .. } => Opcode::JumpForward,
            Self::ListAppend { .. } => Opcode::ListAppend,
            Self::ListExtend { .. } => Opcode::ListExtend,
            Self::LoadAttr { .. } => Opcode::LoadAttr,
            Self::LoadCommonConstant { .. } => Opcode::LoadCommonConstant,
            Self::LoadConst { .. } => Opcode::LoadConst,
            Self::LoadDeref(_) => Opcode::LoadDeref,
            Self::LoadFast(_) => Opcode::LoadFast,
            Self::LoadFastAndClear(_) => Opcode::LoadFastAndClear,
            Self::LoadFastBorrow(_) => Opcode::LoadFastBorrow,
            Self::LoadFastBorrowLoadFastBorrow { .. } => Opcode::LoadFastBorrowLoadFastBorrow,
            Self::LoadFastCheck(_) => Opcode::LoadFastCheck,
            Self::LoadFastLoadFast { .. } => Opcode::LoadFastLoadFast,
            Self::LoadFromDictOrDeref(_) => Opcode::LoadFromDictOrDeref,
            Self::LoadFromDictOrGlobals(_) => Opcode::LoadFromDictOrGlobals,
            Self::LoadGlobal(_) => Opcode::LoadGlobal,
            Self::LoadName(_) => Opcode::LoadName,
            Self::LoadSmallInt { .. } => Opcode::LoadSmallInt,
            Self::LoadSpecial { .. } => Opcode::LoadSpecial,
            Self::LoadSuperAttr { .. } => Opcode::LoadSuperAttr,
            Self::MakeCell(_) => Opcode::MakeCell,
            Self::MapAdd { .. } => Opcode::MapAdd,
            Self::MatchClass(_) => Opcode::MatchClass,
            Self::PopJumpIfFalse { .. } => Opcode::PopJumpIfFalse,
            Self::PopJumpIfNone { .. } => Opcode::PopJumpIfNone,
            Self::PopJumpIfNotNone { .. } => Opcode::PopJumpIfNotNone,
            Self::PopJumpIfTrue { .. } => Opcode::PopJumpIfTrue,
            Self::RaiseVarargs { .. } => Opcode::RaiseVarargs,
            Self::Reraise { .. } => Opcode::Reraise,
            Self::Send { .. } => Opcode::Send,
            Self::SetAdd { .. } => Opcode::SetAdd,
            Self::SetFunctionAttribute { .. } => Opcode::SetFunctionAttribute,
            Self::SetUpdate { .. } => Opcode::SetUpdate,
            Self::StoreAttr { .. } => Opcode::StoreAttr,
            Self::StoreDeref(_) => Opcode::StoreDeref,
            Self::StoreFast(_) => Opcode::StoreFast,
            Self::StoreFastLoadFast { .. } => Opcode::StoreFastLoadFast,
            Self::StoreFastStoreFast { .. } => Opcode::StoreFastStoreFast,
            Self::StoreGlobal(_) => Opcode::StoreGlobal,
            Self::StoreName(_) => Opcode::StoreName,
            Self::Swap { .. } => Opcode::Swap,
            Self::UnpackEx { .. } => Opcode::UnpackEx,
            Self::UnpackSequence { .. } => Opcode::UnpackSequence,
            Self::YieldValue { .. } => Opcode::YieldValue,
            Self::Resume { .. } => Opcode::Resume,
            Self::BinaryOpAddFloat => Opcode::BinaryOpAddFloat,
            Self::BinaryOpAddInt => Opcode::BinaryOpAddInt,
            Self::BinaryOpAddUnicode => Opcode::BinaryOpAddUnicode,
            Self::BinaryOpExtend => Opcode::BinaryOpExtend,
            Self::BinaryOpMultiplyFloat => Opcode::BinaryOpMultiplyFloat,
            Self::BinaryOpMultiplyInt => Opcode::BinaryOpMultiplyInt,
            Self::BinaryOpSubscrDict => Opcode::BinaryOpSubscrDict,
            Self::BinaryOpSubscrGetitem => Opcode::BinaryOpSubscrGetitem,
            Self::BinaryOpSubscrListInt => Opcode::BinaryOpSubscrListInt,
            Self::BinaryOpSubscrListSlice => Opcode::BinaryOpSubscrListSlice,
            Self::BinaryOpSubscrStrInt => Opcode::BinaryOpSubscrStrInt,
            Self::BinaryOpSubscrTupleInt => Opcode::BinaryOpSubscrTupleInt,
            Self::BinaryOpSubtractFloat => Opcode::BinaryOpSubtractFloat,
            Self::BinaryOpSubtractInt => Opcode::BinaryOpSubtractInt,
            Self::CallAllocAndEnterInit => Opcode::CallAllocAndEnterInit,
            Self::CallBoundMethodExactArgs => Opcode::CallBoundMethodExactArgs,
            Self::CallBoundMethodGeneral => Opcode::CallBoundMethodGeneral,
            Self::CallBuiltinClass => Opcode::CallBuiltinClass,
            Self::CallBuiltinFast => Opcode::CallBuiltinFast,
            Self::CallBuiltinFastWithKeywords => Opcode::CallBuiltinFastWithKeywords,
            Self::CallBuiltinO => Opcode::CallBuiltinO,
            Self::CallIsinstance => Opcode::CallIsinstance,
            Self::CallKwBoundMethod => Opcode::CallKwBoundMethod,
            Self::CallKwNonPy => Opcode::CallKwNonPy,
            Self::CallKwPy => Opcode::CallKwPy,
            Self::CallLen => Opcode::CallLen,
            Self::CallListAppend => Opcode::CallListAppend,
            Self::CallMethodDescriptorFast => Opcode::CallMethodDescriptorFast,
            Self::CallMethodDescriptorFastWithKeywords => {
                Opcode::CallMethodDescriptorFastWithKeywords
            }
            Self::CallMethodDescriptorNoargs => Opcode::CallMethodDescriptorNoargs,
            Self::CallMethodDescriptorO => Opcode::CallMethodDescriptorO,
            Self::CallNonPyGeneral => Opcode::CallNonPyGeneral,
            Self::CallPyExactArgs => Opcode::CallPyExactArgs,
            Self::CallPyGeneral => Opcode::CallPyGeneral,
            Self::CallStr1 => Opcode::CallStr1,
            Self::CallTuple1 => Opcode::CallTuple1,
            Self::CallType1 => Opcode::CallType1,
            Self::CompareOpFloat => Opcode::CompareOpFloat,
            Self::CompareOpInt => Opcode::CompareOpInt,
            Self::CompareOpStr => Opcode::CompareOpStr,
            Self::ContainsOpDict => Opcode::ContainsOpDict,
            Self::ContainsOpSet => Opcode::ContainsOpSet,
            Self::ForIterGen => Opcode::ForIterGen,
            Self::ForIterList => Opcode::ForIterList,
            Self::ForIterRange => Opcode::ForIterRange,
            Self::ForIterTuple => Opcode::ForIterTuple,
            Self::JumpBackwardJit => Opcode::JumpBackwardJit,
            Self::JumpBackwardNoJit => Opcode::JumpBackwardNoJit,
            Self::LoadAttrClass => Opcode::LoadAttrClass,
            Self::LoadAttrClassWithMetaclassCheck => Opcode::LoadAttrClassWithMetaclassCheck,
            Self::LoadAttrGetattributeOverridden => Opcode::LoadAttrGetattributeOverridden,
            Self::LoadAttrInstanceValue => Opcode::LoadAttrInstanceValue,
            Self::LoadAttrMethodLazyDict => Opcode::LoadAttrMethodLazyDict,
            Self::LoadAttrMethodNoDict => Opcode::LoadAttrMethodNoDict,
            Self::LoadAttrMethodWithValues => Opcode::LoadAttrMethodWithValues,
            Self::LoadAttrModule => Opcode::LoadAttrModule,
            Self::LoadAttrNondescriptorNoDict => Opcode::LoadAttrNondescriptorNoDict,
            Self::LoadAttrNondescriptorWithValues => Opcode::LoadAttrNondescriptorWithValues,
            Self::LoadAttrProperty => Opcode::LoadAttrProperty,
            Self::LoadAttrSlot => Opcode::LoadAttrSlot,
            Self::LoadAttrWithHint => Opcode::LoadAttrWithHint,
            Self::LoadConstImmortal => Opcode::LoadConstImmortal,
            Self::LoadConstMortal => Opcode::LoadConstMortal,
            Self::LoadGlobalBuiltin => Opcode::LoadGlobalBuiltin,
            Self::LoadGlobalModule => Opcode::LoadGlobalModule,
            Self::LoadSuperAttrAttr => Opcode::LoadSuperAttrAttr,
            Self::LoadSuperAttrMethod => Opcode::LoadSuperAttrMethod,
            Self::ResumeCheck => Opcode::ResumeCheck,
            Self::SendGen => Opcode::SendGen,
            Self::StoreAttrInstanceValue => Opcode::StoreAttrInstanceValue,
            Self::StoreAttrSlot => Opcode::StoreAttrSlot,
            Self::StoreAttrWithHint => Opcode::StoreAttrWithHint,
            Self::StoreSubscrDict => Opcode::StoreSubscrDict,
            Self::StoreSubscrListInt => Opcode::StoreSubscrListInt,
            Self::ToBoolAlwaysTrue => Opcode::ToBoolAlwaysTrue,
            Self::ToBoolBool => Opcode::ToBoolBool,
            Self::ToBoolInt => Opcode::ToBoolInt,
            Self::ToBoolList => Opcode::ToBoolList,
            Self::ToBoolNone => Opcode::ToBoolNone,
            Self::ToBoolStr => Opcode::ToBoolStr,
            Self::UnpackSequenceList => Opcode::UnpackSequenceList,
            Self::UnpackSequenceTuple => Opcode::UnpackSequenceTuple,
            Self::UnpackSequenceTwoTuple => Opcode::UnpackSequenceTwoTuple,
            Self::InstrumentedEndFor => Opcode::InstrumentedEndFor,
            Self::InstrumentedPopIter => Opcode::InstrumentedPopIter,
            Self::InstrumentedEndSend => Opcode::InstrumentedEndSend,
            Self::InstrumentedForIter => Opcode::InstrumentedForIter,
            Self::InstrumentedInstruction => Opcode::InstrumentedInstruction,
            Self::InstrumentedJumpForward => Opcode::InstrumentedJumpForward,
            Self::InstrumentedNotTaken => Opcode::InstrumentedNotTaken,
            Self::InstrumentedPopJumpIfTrue => Opcode::InstrumentedPopJumpIfTrue,
            Self::InstrumentedPopJumpIfFalse => Opcode::InstrumentedPopJumpIfFalse,
            Self::InstrumentedPopJumpIfNone => Opcode::InstrumentedPopJumpIfNone,
            Self::InstrumentedPopJumpIfNotNone => Opcode::InstrumentedPopJumpIfNotNone,
            Self::InstrumentedResume => Opcode::InstrumentedResume,
            Self::InstrumentedReturnValue => Opcode::InstrumentedReturnValue,
            Self::InstrumentedYieldValue => Opcode::InstrumentedYieldValue,
            Self::InstrumentedEndAsyncFor => Opcode::InstrumentedEndAsyncFor,
            Self::InstrumentedLoadSuperAttr => Opcode::InstrumentedLoadSuperAttr,
            Self::InstrumentedCall => Opcode::InstrumentedCall,
            Self::InstrumentedCallKw => Opcode::InstrumentedCallKw,
            Self::InstrumentedCallFunctionEx => Opcode::InstrumentedCallFunctionEx,
            Self::InstrumentedJumpBackward => Opcode::InstrumentedJumpBackward,
            Self::InstrumentedLine => Opcode::InstrumentedLine,
            Self::EnterExecutor => Opcode::EnterExecutor,
        }
    }

    pub fn stack_effect(self) -> StackEffect {
        // NOTE: Reason for converting oparg to `i32` is because of expressions like `1 + (oparg -1)`
        // that causes underflow errors.

        let (pushed, popped) = match self {
            Self::Cache => (0, 0),
            Self::BinarySlice => (1, 3),
            Self::BuildTemplate => (1, 2),
            Self::BinaryOpInplaceAddUnicode => (0, 2),
            Self::CallFunctionEx => (1, 4),
            Self::CheckEgMatch => (2, 2),
            Self::CheckExcMatch => (2, 2),
            Self::CleanupThrow => (2, 3),
            Self::DeleteSubscr => (0, 2),
            Self::EndFor => (0, 1),
            Self::EndSend => (1, 2),
            Self::ExitInitCheck => (0, 1),
            Self::FormatSimple => (1, 1),
            Self::FormatWithSpec => (1, 2),
            Self::GetAIter => (1, 1),
            Self::GetANext => (2, 1),
            Self::GetIter => (1, 1),
            Self::Reserved => (0, 0),
            Self::GetLen => (2, 1),
            Self::GetYieldFromIter => (1, 1),
            Self::InterpreterExit => (0, 1),
            Self::LoadBuildClass => (1, 0),
            Self::LoadLocals => (1, 0),
            Self::MakeFunction => (1, 1),
            Self::MatchKeys => (3, 2),
            Self::MatchMapping => (2, 1),
            Self::MatchSequence => (2, 1),
            Self::Nop => (0, 0),
            Self::NotTaken => (0, 0),
            Self::PopExcept => (0, 1),
            Self::PopIter => (0, 1),
            Self::PopTop => (0, 1),
            Self::PushExcInfo => (2, 1),
            Self::PushNull => (1, 0),
            Self::ReturnGenerator => (1, 0),
            Self::ReturnValue => (0, 1),
            Self::SetupAnnotations => (0, 0),
            Self::StoreSlice => (0, 4),
            Self::StoreSubscr => (0, 3),
            Self::ToBool => (1, 1),
            Self::UnaryInvert => (1, 1),
            Self::UnaryNegative => (1, 1),
            Self::UnaryNot => (1, 1),
            Self::WithExceptStart => (6, 5),
            Self::BinaryOp { .. } => (1, 2),
            Self::BuildInterpolation { oparg } => {
                let oparg = i32::try_from(u32::from(oparg)).expect("oparg does not fit in an i32");
                (1, 2 + (oparg & 1))
            }
            Self::BuildList { size } => {
                let oparg = i32::try_from(u32::from(size)).expect("oparg does not fit in an i32");
                (1, oparg)
            }
            Self::BuildMap { size } => {
                let oparg = i32::try_from(u32::from(size)).expect("oparg does not fit in an i32");
                (1, oparg * 2)
            }
            Self::BuildSet { size } => {
                let oparg = i32::try_from(u32::from(size)).expect("oparg does not fit in an i32");
                (1, oparg)
            }
            Self::BuildSlice { argc } => {
                let oparg = i32::try_from(u32::from(argc)).expect("oparg does not fit in an i32");
                (1, oparg)
            }
            Self::BuildString { size } => {
                let oparg = i32::try_from(u32::from(size)).expect("oparg does not fit in an i32");
                (1, oparg)
            }
            Self::BuildTuple { size } => {
                let oparg = i32::try_from(u32::from(size)).expect("oparg does not fit in an i32");
                (1, oparg)
            }
            Self::Call { nargs } => {
                let oparg = i32::try_from(u32::from(nargs)).expect("oparg does not fit in an i32");
                (1, 2 + oparg)
            }
            Self::CallIntrinsic1 { .. } => (1, 1),
            Self::CallIntrinsic2 { .. } => (1, 2),
            Self::CallKw { nargs } => {
                let oparg = i32::try_from(u32::from(nargs)).expect("oparg does not fit in an i32");
                (1, 3 + oparg)
            }
            Self::CompareOp { .. } => (1, 2),
            Self::ContainsOp(_) => (1, 2),
            Self::ConvertValue { .. } => (1, 1),
            Self::Copy { index } => {
                let oparg = i32::try_from(u32::from(index)).expect("oparg does not fit in an i32");
                (2 + (oparg - 1), 1 + (oparg - 1))
            }
            Self::CopyFreeVars { .. } => (0, 0),
            Self::DeleteAttr { .. } => (0, 1),
            Self::DeleteDeref(_) => (0, 0),
            Self::DeleteFast(_) => (0, 0),
            Self::DeleteGlobal(_) => (0, 0),
            Self::DeleteName(_) => (0, 0),
            Self::DictMerge { index } => {
                let oparg = i32::try_from(u32::from(index)).expect("oparg does not fit in an i32");
                (4 + (oparg - 1), 5 + (oparg - 1))
            }
            Self::DictUpdate { index } => {
                let oparg = i32::try_from(u32::from(index)).expect("oparg does not fit in an i32");
                (1 + (oparg - 1), 2 + (oparg - 1))
            }
            Self::EndAsyncFor => (0, 2),
            Self::ExtendedArg => (0, 0),
            Self::ForIter { .. } => (2, 1),
            Self::GetAwaitable { .. } => (1, 1),
            Self::ImportFrom { .. } => (2, 1),
            Self::ImportName { .. } => (1, 2),
            Self::IsOp(_) => (1, 2),
            Self::JumpBackward { .. } => (0, 0),
            Self::JumpBackwardNoInterrupt { .. } => (0, 0),
            Self::JumpForward { .. } => (0, 0),
            Self::ListAppend { i } => {
                let oparg = i32::try_from(u32::from(i)).expect("oparg does not fit in an i32");
                (1 + (oparg - 1), 2 + (oparg - 1))
            }
            Self::ListExtend { i } => {
                let oparg = i32::try_from(u32::from(i)).expect("oparg does not fit in an i32");
                (1 + (oparg - 1), 2 + (oparg - 1))
            }
            Self::LoadAttr { idx } => {
                let oparg = i32::try_from(u32::from(idx)).expect("oparg does not fit in an i32");
                (1 + (oparg & 1), 1)
            }
            Self::LoadCommonConstant { .. } => (1, 0),
            Self::LoadConst { .. } => (1, 0),
            Self::LoadDeref(_) => (1, 0),
            Self::LoadFast(_) => (1, 0),
            Self::LoadFastAndClear(_) => (1, 0),
            Self::LoadFastBorrow(_) => (1, 0),
            Self::LoadFastBorrowLoadFastBorrow { .. } => (2, 0),
            Self::LoadFastCheck(_) => (1, 0),
            Self::LoadFastLoadFast { .. } => (2, 0),
            Self::LoadFromDictOrDeref(_) => (1, 1),
            Self::LoadFromDictOrGlobals(_) => (1, 1),
            Self::LoadGlobal(_) => (1, 0),
            Self::LoadName(_) => (1, 0),
            Self::LoadSmallInt { .. } => (1, 0),
            Self::LoadSpecial { .. } => (2, 1),
            Self::LoadSuperAttr { arg } => {
                let oparg = i32::try_from(u32::from(arg)).expect("oparg does not fit in an i32");
                (1 + (oparg & 1), 3)
            }
            Self::MakeCell(_) => (0, 0),
            Self::MapAdd { i } => {
                let oparg = i32::try_from(u32::from(i)).expect("oparg does not fit in an i32");
                (1 + (oparg - 1), 3 + (oparg - 1))
            }
            Self::MatchClass(_) => (1, 3),
            Self::PopJumpIfFalse { .. } => (0, 1),
            Self::PopJumpIfNone { .. } => (0, 1),
            Self::PopJumpIfNotNone { .. } => (0, 1),
            Self::PopJumpIfTrue { .. } => (0, 1),
            Self::RaiseVarargs { kind } => (
                0,
                match kind {
                    oparg::RaiseKind::BareRaise => 0,
                    oparg::RaiseKind::Raise => 1,
                    oparg::RaiseKind::RaiseCause => 2,
                    oparg::RaiseKind::ReraiseFromStack => 1,
                },
            ),
            Self::Reraise { depth } => {
                let oparg = i32::try_from(u32::from(depth)).expect("oparg does not fit in an i32");
                (1 + oparg, 1 + oparg)
            }
            Self::Send { .. } => (2, 2),
            Self::SetAdd { i } => {
                let oparg = i32::try_from(u32::from(i)).expect("oparg does not fit in an i32");
                (1 + (oparg - 1), 2 + (oparg - 1))
            }
            Self::SetFunctionAttribute { .. } => (1, 2),
            Self::SetUpdate { i } => {
                let oparg = i32::try_from(u32::from(i)).expect("oparg does not fit in an i32");
                (1 + (oparg - 1), 2 + (oparg - 1))
            }
            Self::StoreAttr { .. } => (0, 2),
            Self::StoreDeref(_) => (0, 1),
            Self::StoreFast(_) => (0, 1),
            Self::StoreFastLoadFast { .. } => (1, 1),
            Self::StoreFastStoreFast { .. } => (0, 2),
            Self::StoreGlobal(_) => (0, 1),
            Self::StoreName(_) => (0, 1),
            Self::Swap { index } => {
                let oparg = i32::try_from(u32::from(index)).expect("oparg does not fit in an i32");
                (2 + (oparg - 2), 2 + (oparg - 2))
            }
            Self::UnpackEx { args } => {
                let oparg = i32::try_from(u32::from(args)).expect("oparg does not fit in an i32");
                (1 + (oparg & 0xFF) + (oparg >> 8), 1)
            }
            Self::UnpackSequence { size } => {
                let oparg = i32::try_from(u32::from(size)).expect("oparg does not fit in an i32");
                (oparg, 1)
            }
            Self::YieldValue { .. } => (1, 1),
            Self::Resume { .. } => (0, 0),
            Self::BinaryOpAddFloat => (1, 2),
            Self::BinaryOpAddInt => (1, 2),
            Self::BinaryOpAddUnicode => (1, 2),
            Self::BinaryOpExtend => (1, 2),
            Self::BinaryOpMultiplyFloat => (1, 2),
            Self::BinaryOpMultiplyInt => (1, 2),
            Self::BinaryOpSubscrDict => (1, 2),
            Self::BinaryOpSubscrGetitem => (0, 2),
            Self::BinaryOpSubscrListInt => (1, 2),
            Self::BinaryOpSubscrListSlice => (1, 2),
            Self::BinaryOpSubscrStrInt => (1, 2),
            Self::BinaryOpSubscrTupleInt => (1, 2),
            Self::BinaryOpSubtractFloat => (1, 2),
            Self::BinaryOpSubtractInt => (1, 2),
            Self::CallAllocAndEnterInit => {
                let oparg = 0; // Placeholder
                (0, 2 + oparg)
            }
            Self::CallBoundMethodExactArgs => {
                let oparg = 0; // Placeholder
                (0, 2 + oparg)
            }
            Self::CallBoundMethodGeneral => {
                let oparg = 0; // Placeholder
                (0, 2 + oparg)
            }
            Self::CallBuiltinClass => {
                let oparg = 0; // Placeholder
                (1, 2 + oparg)
            }
            Self::CallBuiltinFast => {
                let oparg = 0; // Placeholder
                (1, 2 + oparg)
            }
            Self::CallBuiltinFastWithKeywords => {
                let oparg = 0; // Placeholder
                (1, 2 + oparg)
            }
            Self::CallBuiltinO => {
                let oparg = 0; // Placeholder
                (1, 2 + oparg)
            }
            Self::CallIsinstance => {
                let oparg = 0; // Placeholder
                (1, 2 + oparg)
            }
            Self::CallKwBoundMethod => {
                let oparg = 0; // Placeholder
                (0, 3 + oparg)
            }
            Self::CallKwNonPy => {
                let oparg = 0; // Placeholder
                (1, 3 + oparg)
            }
            Self::CallKwPy => {
                let oparg = 0; // Placeholder
                (0, 3 + oparg)
            }
            Self::CallLen => (1, 3),
            Self::CallListAppend => (0, 3),
            Self::CallMethodDescriptorFast => {
                let oparg = 0; // Placeholder
                (1, 2 + oparg)
            }
            Self::CallMethodDescriptorFastWithKeywords => {
                let oparg = 0; // Placeholder
                (1, 2 + oparg)
            }
            Self::CallMethodDescriptorNoargs => {
                let oparg = 0; // Placeholder
                (1, 2 + oparg)
            }
            Self::CallMethodDescriptorO => {
                let oparg = 0; // Placeholder
                (1, 2 + oparg)
            }
            Self::CallNonPyGeneral => {
                let oparg = 0; // Placeholder
                (1, 2 + oparg)
            }
            Self::CallPyExactArgs => {
                let oparg = 0; // Placeholder
                (0, 2 + oparg)
            }
            Self::CallPyGeneral => {
                let oparg = 0; // Placeholder
                (0, 2 + oparg)
            }
            Self::CallStr1 => (1, 3),
            Self::CallTuple1 => (1, 3),
            Self::CallType1 => (1, 3),
            Self::CompareOpFloat => (1, 2),
            Self::CompareOpInt => (1, 2),
            Self::CompareOpStr => (1, 2),
            Self::ContainsOpDict => (1, 2),
            Self::ContainsOpSet => (1, 2),
            Self::ForIterGen => (1, 1),
            Self::ForIterList => (2, 1),
            Self::ForIterRange => (2, 1),
            Self::ForIterTuple => (2, 1),
            Self::JumpBackwardJit => (0, 0),
            Self::JumpBackwardNoJit => (0, 0),
            Self::LoadAttrClass => {
                let oparg = 0; // Placeholder
                (1 + (oparg & 1), 1)
            }
            Self::LoadAttrClassWithMetaclassCheck => {
                let oparg = 0; // Placeholder
                (1 + (oparg & 1), 1)
            }
            Self::LoadAttrGetattributeOverridden => (1, 1),
            Self::LoadAttrInstanceValue => {
                let oparg = 0; // Placeholder
                (1 + (oparg & 1), 1)
            }
            Self::LoadAttrMethodLazyDict => (2, 1),
            Self::LoadAttrMethodNoDict => (2, 1),
            Self::LoadAttrMethodWithValues => (2, 1),
            Self::LoadAttrModule => {
                let oparg = 0; // Placeholder
                (1 + (oparg & 1), 1)
            }
            Self::LoadAttrNondescriptorNoDict => (1, 1),
            Self::LoadAttrNondescriptorWithValues => (1, 1),
            Self::LoadAttrProperty => (0, 1),
            Self::LoadAttrSlot => {
                let oparg = 0; // Placeholder
                (1 + (oparg & 1), 1)
            }
            Self::LoadAttrWithHint => {
                let oparg = 0; // Placeholder
                (1 + (oparg & 1), 1)
            }
            Self::LoadConstImmortal => (1, 0),
            Self::LoadConstMortal => (1, 0),
            Self::LoadGlobalBuiltin => {
                let oparg = 0; // Placeholder
                (1 + (oparg & 1), 0)
            }
            Self::LoadGlobalModule => {
                let oparg = 0; // Placeholder
                (1 + (oparg & 1), 0)
            }
            Self::LoadSuperAttrAttr => (1, 3),
            Self::LoadSuperAttrMethod => (2, 3),
            Self::ResumeCheck => (0, 0),
            Self::SendGen => (1, 2),
            Self::StoreAttrInstanceValue => (0, 2),
            Self::StoreAttrSlot => (0, 2),
            Self::StoreAttrWithHint => (0, 2),
            Self::StoreSubscrDict => (0, 3),
            Self::StoreSubscrListInt => (0, 3),
            Self::ToBoolAlwaysTrue => (1, 1),
            Self::ToBoolBool => (1, 1),
            Self::ToBoolInt => (1, 1),
            Self::ToBoolList => (1, 1),
            Self::ToBoolNone => (1, 1),
            Self::ToBoolStr => (1, 1),
            Self::UnpackSequenceList => {
                let oparg = 0; // Placeholder
                (oparg, 1)
            }
            Self::UnpackSequenceTuple => {
                let oparg = 0; // Placeholder
                (oparg, 1)
            }
            Self::UnpackSequenceTwoTuple => (2, 1),
            Self::InstrumentedEndFor => (1, 2),
            Self::InstrumentedPopIter => (0, 1),
            Self::InstrumentedEndSend => (1, 2),
            Self::InstrumentedForIter => (2, 1),
            Self::InstrumentedInstruction => (0, 0),
            Self::InstrumentedJumpForward => (0, 0),
            Self::InstrumentedNotTaken => (0, 0),
            Self::InstrumentedPopJumpIfTrue => (0, 1),
            Self::InstrumentedPopJumpIfFalse => (0, 1),
            Self::InstrumentedPopJumpIfNone => (0, 1),
            Self::InstrumentedPopJumpIfNotNone => (0, 1),
            Self::InstrumentedResume => (0, 0),
            Self::InstrumentedReturnValue => (1, 1),
            Self::InstrumentedYieldValue => (1, 1),
            Self::InstrumentedEndAsyncFor => (0, 2),
            Self::InstrumentedLoadSuperAttr => {
                let oparg = 0; // Placeholder
                (1 + (oparg & 1), 3)
            }
            Self::InstrumentedCall => {
                let oparg = 0; // Placeholder
                (1, 2 + oparg)
            }
            Self::InstrumentedCallKw => {
                let oparg = 0; // Placeholder
                (1, 3 + oparg)
            }
            Self::InstrumentedCallFunctionEx => (1, 4),
            Self::InstrumentedJumpBackward => (0, 0),
            Self::InstrumentedLine => (0, 0),
            Self::EnterExecutor => (0, 0),
        };

        StackEffect::new(pushed as u32, popped as u32)
    }
}

impl From<Instruction> for Opcode {
    fn from(value: Instruction) -> Self {
        value.opcode()
    }
}

impl From<Instruction> for StackEffect {
    fn from(value: Instruction) -> Self {
        value.stack_effect()
    }
}

#[derive(Clone, Copy, Debug)]
pub enum PseudoInstruction {
    AnnotationsPlaceholder,
    Jump { target: oparg::Label },
    JumpIfFalse { target: oparg::Label },
    JumpIfTrue { target: oparg::Label },
    JumpNoInterrupt { target: oparg::Label },
    LoadClosure(oparg::NameIdx),
    PopBlock,
    SetupCleanup { target: oparg::Label },
    SetupFinally { target: oparg::Label },
    SetupWith { target: oparg::Label },
    StoreFastMaybeNull(oparg::NameIdx),
}

impl PseudoInstruction {
    pub fn fmt_dis(
        self,
        f: &mut fmt::Formatter<'_>,
        ctx: &impl InstrDisplayContext,
        expand_code_objects: bool,
        pad: usize,
        level: usize,
    ) -> fmt::Result {
        let opcode = self.opcode();

        match self {
            Self::AnnotationsPlaceholder => write!(f, "{opcode}"),
            Self::Jump { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::JumpIfFalse { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::JumpIfTrue { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::JumpNoInterrupt { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::LoadClosure(oparg) => write!(f, "{:pad$}({})", opcode, oparg),
            Self::PopBlock => write!(f, "{opcode}"),
            Self::SetupCleanup { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::SetupFinally { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::SetupWith { target } => write!(f, "{:pad$}({})", opcode, target),
            Self::StoreFastMaybeNull(oparg) => write!(f, "{:pad$}({})", opcode, oparg),
        }
    }

    /// Instruction's opcode.
    #[must_use]
    pub const fn opcode(self) -> PseudoOpcode {
        match self {
            Self::AnnotationsPlaceholder => PseudoOpcode::AnnotationsPlaceholder,
            Self::Jump { .. } => PseudoOpcode::Jump,
            Self::JumpIfFalse { .. } => PseudoOpcode::JumpIfFalse,
            Self::JumpIfTrue { .. } => PseudoOpcode::JumpIfTrue,
            Self::JumpNoInterrupt { .. } => PseudoOpcode::JumpNoInterrupt,
            Self::LoadClosure(_) => PseudoOpcode::LoadClosure,
            Self::PopBlock => PseudoOpcode::PopBlock,
            Self::SetupCleanup { .. } => PseudoOpcode::SetupCleanup,
            Self::SetupFinally { .. } => PseudoOpcode::SetupFinally,
            Self::SetupWith { .. } => PseudoOpcode::SetupWith,
            Self::StoreFastMaybeNull(_) => PseudoOpcode::StoreFastMaybeNull,
        }
    }

    pub fn stack_effect(self) -> StackEffect {
        // NOTE: Reason for converting oparg to `i32` is because of expressions like `1 + (oparg -1)`
        // that causes underflow errors.

        let (pushed, popped) = match self {
            Self::AnnotationsPlaceholder => (0, 0),
            Self::Jump { .. } => (0, 0),
            Self::JumpIfFalse { .. } => (1, 1),
            Self::JumpIfTrue { .. } => (1, 1),
            Self::JumpNoInterrupt { .. } => (0, 0),
            Self::LoadClosure(_) => (1, 0),
            Self::PopBlock => (0, 0),
            Self::SetupCleanup { .. } => (2, 0),
            Self::SetupFinally { .. } => (1, 0),
            Self::SetupWith { .. } => (1, 0),
            Self::StoreFastMaybeNull(_) => (0, 1),
        };

        StackEffect::new(pushed as u32, popped as u32)
    }
}

impl From<PseudoInstruction> for PseudoOpcode {
    fn from(value: PseudoInstruction) -> Self {
        value.opcode()
    }
}

impl From<PseudoInstruction> for StackEffect {
    fn from(value: PseudoInstruction) -> Self {
        value.stack_effect()
    }
}
